<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì²­ì²©ì¥ URL ë¶„ì„</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px;color:#111}
.card{max-width:640px;margin:0 auto;padding:20px;border:1px solid #ddd;border-radius:12px}
label{display:block;margin:12px 0 4px;font-weight:600}
input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
.row{display:flex;gap:8px}
.btn{padding:12px 16px;border:0;border-radius:8px;background:#111;color:#fff;cursor:pointer}
.hint{color:#666;font-size:12px;margin-top:4px}
pre{white-space:pre-wrap;border:1px solid #ccc;padding:12px;border-radius:8px;background:#f9f9f9}
.success{color:#0a0;margin-top:12px}
.error{color:#c00;margin-top:12px}
</style>
</head>
<body>
  <div class="card">
    <h2>ì²­ì²©ì¥ URL ë¶„ì„</h2>
    <p class="hint">ê°œì¸ì •ë³´ ë™ì˜ í›„ URLì„ ì…ë ¥í•˜ë©´, ì˜ˆì‹ì¼/ì‹œê°„/ì˜ˆì‹ì¥ ì •ë³´ë¥¼ AIë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>

    <label>ëª¨ë°”ì¼ ì²­ì²©ì¥ URL</label>
    <div class="row">
      <input id="inviteUrl" placeholder="https://..." />
      <button class="btn" id="btnExtract" type="button">ì •ë³´ ê°€ì ¸ì˜¤ê¸°</button>
    </div>
    <p id="extractMsg" class="hint"></p>

    <div id="result" style="display:none">
      <h3>ì¶”ì¶œ ê²°ê³¼ (JSON)</h3>
      <pre id="resultPre"></pre>

      <h3>ğŸ“ ê²Œì‹œíŒ ì•ˆë‚´ë¬¸ í˜•ì‹</h3>
      <pre id="boardPreview"></pre>

      <button class="btn" id="goDetail">ì„¸ë¶€ ì •ë³´ í™•ì¸/ì œì¶œë¡œ ì´ë™</button>
    </div>
  </div>

<script>
if (localStorage.getItem('consent') !== 'true') {
  // ë™ì˜ ì•ˆí–ˆìœ¼ë©´ ì²« í˜ì´ì§€ë¡œ
  location.href = 'privacy.html';
}

// ğŸš© Apps Script ì›¹ì•± URL (/exec) ì •í™•íˆ ì…ë ¥
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

document.getElementById('btnExtract').addEventListener('click', async ()=>{
  const url = document.getElementById('inviteUrl').value.trim();
  const msg = document.getElementById('extractMsg');
  const result = document.getElementById('result');
  const pre = document.getElementById('resultPre');
  const board = document.getElementById('boardPreview');

  result.style.display = 'none';
  msg.textContent = '';
  pre.textContent = '';
  board.textContent = '';

  if (!url) { msg.textContent = 'URLì„ ì…ë ¥í•˜ì„¸ìš”.'; return; }
  msg.textContent = 'ë¶„ì„ ì¤‘...';

  try {
    const res = await fetch(ENDPOINT + '?action=extract&url=' + encodeURIComponent(url));
    const text = await res.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch (e) {
      console.error('ì„œë²„ ì‘ë‹µ ì›ë¬¸:', text.slice(0,400));
      msg.textContent = 'ì„œë²„ê°€ JSON ëŒ€ì‹  HTMLì„ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤. ì›¹ì•± URL(/exec)Â·ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.';
      msg.className = 'error';
      return;
    }

    if (!data.ok) {
      msg.textContent = 'ì¶”ì¶œ ì‹¤íŒ¨: ' + (data.error || 'ì›ì¸ ë¯¸ìƒ');
      msg.className = 'error';
      return;
    }

    // JSON ìš”ì•½ í‘œì‹œ
    const summary = {
      groomFather: data.groomFather || '',
      groomMother: data.groomMother || '',
      groomName:   data.groomName   || '',
      brideFather: data.brideFather || '',
      brideMother: data.brideMother || '',
      brideName:   data.brideName   || '',
      order:       data.order       || '',
      eventDate:   data.eventDate   || '',
      eventTime:   data.eventTime   || '',
      venue:       data.venue       || '',
      venueAddr:   data.venueAddr   || ''
    };
    pre.textContent = JSON.stringify(summary, null, 2);

    // ì•ˆë‚´ë¬¸ í˜•ì‹ í‘œì‹œ
    if (data.boardText) {
      board.textContent = data.boardText;
    } else {
      board.textContent = '(ì•ˆë‚´ë¬¸ í˜•ì‹ ì¶”ì¶œ ì‹¤íŒ¨)';
    }

    result.style.display = 'block';
    msg.textContent = 'ì •ë³´ê°€ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤.';
    msg.className = 'success';

    // ë‹¤ìŒ ë‹¨ê³„ì— ë„˜ê¸°ê¸° (ì„¸ë¶€ ì…ë ¥ í˜ì´ì§€ìš©)
    localStorage.setItem('inviteExtract', JSON.stringify(summary));
    localStorage.setItem('inviteUrl', url);

  } catch (err) {
    msg.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + err.message;
    msg.className = 'error';
  }
});

document.getElementById('goDetail').addEventListener('click', ()=>{
  location.href = 'wedding.html';
});
</script>
</body>
</html>
