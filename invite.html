<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>추가 정보 입력</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;padding:24px;background:#f9f9f9;color:#111}
.card{max-width:720px;margin:0 auto;background:#fff;padding:24px;border-radius:16px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
h2{margin-top:0}
label{display:block;margin:12px 0 6px;font-weight:600}
input,select{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
.row{display:flex;gap:8px}
.btn{padding:12px 16px;border:0;border-radius:8px;cursor:pointer;font-weight:600}
.btn.primary{background:#111;color:#fff;width:100%;margin-top:16px}
.btn.secondary{background:#eee}
.hint{font-size:12px;color:#666;margin-top:4px}
.preview{white-space:pre-wrap;border:1px solid #ddd;padding:16px;border-radius:12px;background:#fafafa;margin-top:16px}
.hidden{display:none}
.section{margin-top:24px;padding-top:16px;border-top:1px solid #eee}
</style>
</head>
<body>
<div class="card">
  <h2>추가 정보 입력</h2>

  <!-- 기본정보 (inviteExtract에서 채워짐 + 수정 가능) -->
  <div class="section">
    <label>신랑측 *</label>
    <input id="groomInfo" />

    <label>신부측 *</label>
    <input id="brideInfo" />

    <label>예식일시 *</label>
    <div class="row">
      <input type="date" id="eventDate" />
      <input type="time" id="eventTime" step="600" />
    </div>

    <label>예식장 *</label>
    <input id="venue" />

    <label>예식장 주소 *</label>
    <input id="venueAddr" />

    <label>스몰웨딩 여부 *</label>
    <select id="isSmallWedding">
      <option value="">선택</option><option>예</option><option>아니오</option>
    </select>
  </div>

  <!-- 추가 정보 입력 -->
  <div class="section">
    <label>임원 성함 *</label>
    <input id="name" required />

    <label>재직/퇴직 *</label>
    <select id="empStatus" required>
      <option value="">선택</option><option>재직</option><option>퇴직</option>
    </select>

    <label>근무 부서 *</label>
    <input id="deptWhenEmployed" placeholder="○○개발3그룹(무선)" />

    <label>현 직장/직책 *</label>
    <input id="currentJobTitle" />

    <label>청탁금지법 대상 여부 *</label>
    <select id="antiGraft">
      <option value="">선택</option><option>대상</option><option>비대상</option>
    </select>

    <!-- 배우자 정보 추가 (청탁금지법 → 대상 → 배우자 선택 시 보이게) -->
    <div id="spouseWrap" class="hidden">
      <label>대상자 확인 *</label>
      <select id="targetWho">
        <option value="">선택</option><option>본인</option><option>배우자</option>
      </select>
      <div id="spouseJobWrap" class="hidden">
        <label>배우자 현 직장/직책 *</label>
        <input id="spouseJobTitle" />
      </div>
    </div>

    <label>축의계좌 *</label>
    <input id="bankNumber" placeholder="000-0000-0000-00" />

    <label>은행 *</label>
    <select id="bankName">
      <option value="">선택</option>
      <option>국민</option><option>신한</option><option>우리</option>
      <option>하나</option><option>농협</option><option>기업</option>
      <option value="기타">기타</option>
    </select>
    <div id="bankEtcWrap" class="hidden">
      <label>은행 (기타)</label>
      <input id="bankNameEtc" />
    </div>

    <label>연락처 *</label>
    <input id="phone" placeholder="010-1234-5678" />

    <label>퇴임임원 문자 알림 계좌번호 공개 여부 *</label>
    <select id="accountDisclosure">
      <option value="">선택</option><option>희망</option><option>비희망</option>
    </select>
  </div>

  <!-- 미리보기 + 제출 -->
  <div class="section">
    <button type="button" class="btn secondary" id="btnPreview">게시글 미리보기</button>
    <div id="previewBox" class="preview hidden"></div>
    <button class="btn primary" id="btnSubmit">제출</button>
  </div>
</div>

<script>
// ====== 초기에 inviteExtract 값 반영 ======
window.addEventListener('DOMContentLoaded',()=>{
  const saved=localStorage.getItem('inviteExtract');
  if(saved){
    try{
      const d=JSON.parse(saved);
      if(d.groomInfo) document.getElementById('groomInfo').value=d.groomInfo;
      if(d.brideInfo) document.getElementById('brideInfo').value=d.brideInfo;
      if(d.eventDate) document.getElementById('eventDate').value=d.eventDate;
      if(d.eventTime) document.getElementById('eventTime').value=d.eventTime;
      if(d.venue) document.getElementById('venue').value=d.venue;
      if(d.venueAddr) document.getElementById('venueAddr').value=d.venueAddr;
      if(d.isSmallWedding) document.getElementById('isSmallWedding').value=d.isSmallWedding;
    }catch(e){ console.error("inviteExtract parse error",e); }
  }
});

// ====== 청탁금지법 로직 ======
document.getElementById('antiGraft').addEventListener('change',()=>{
  const v=document.getElementById('antiGraft').value;
  document.getElementById('spouseWrap').classList.toggle('hidden',v!=="대상");
});
document.getElementById('targetWho').addEventListener('change',()=>{
  const v=document.getElementById('targetWho').value;
  document.getElementById('spouseJobWrap').classList.toggle('hidden',v!=="배우자");
});

// ====== 은행 기타 ======
document.getElementById('bankName').addEventListener('change',()=>{
  const v=document.getElementById('bankName').value;
  document.getElementById('bankEtcWrap').classList.toggle('hidden',v!=="기타");
});

// ====== 미리보기 ======
document.getElementById('btnPreview').addEventListener('click',()=>{
  const groom=document.getElementById('groomInfo').value;
  const bride=document.getElementById('brideInfo').value;
  const date=document.getElementById('eventDate').value;
  const time=document.getElementById('eventTime').value;
  const venue=document.getElementById('venue').value;
  const addr=document.getElementById('venueAddr').value;
  const name=document.getElementById('name').value;
  const job=document.getElementById('currentJobTitle').value;
  const phone=document.getElementById('phone').value;
  const bank=document.getElementById('bankName').value==="기타"
    ? document.getElementById('bankNameEtc').value
    : document.getElementById('bankName').value;
  const bankNum=document.getElementById('bankNumber').value;

  const preview=`${groom}
${bride}
□ 일 시 : ${date} ${time}
□ 장 소 : ${venue}
           (${addr})
□ 연락처 : ${phone} (${name} ${job})
□ 축의계좌 : ${bank} ${bankNum} (${name})`;

  document.getElementById('previewBox').textContent=preview;
  document.getElementById('previewBox').classList.remove('hidden');
});

// ====== 제출 ======
const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";
document.getElementById('btnSubmit').addEventListener('click',async()=>{
  const payload={
    groomInfo:document.getElementById('groomInfo').value,
    brideInfo:document.getElementById('brideInfo').value,
    eventDate:document.getElementById('eventDate').value,
    eventTime:document.getElementById('eventTime').value,
    venue:document.getElementById('venue').value,
    venueAddr:document.getElementById('venueAddr').value,
    isSmallWedding:document.getElementById('isSmallWedding').value,
    name:document.getElementById('name').value,
    empStatus:document.getElementById('empStatus').value,
    deptWhenEmployed:document.getElementById('deptWhenEmployed').value,
    currentJobTitle:document.getElementById('currentJobTitle').value,
    antiGraft:document.getElementById('antiGraft').value,
    targetWho:document.getElementById('targetWho').value,
    spouseJobTitle:document.getElementById('spouseJobTitle').value,
    bankNumber:document.getElementById('bankNumber').value,
    bankName:document.getElementById('bankName').value==="기타"
      ? document.getElementById('bankNameEtc').value
      : document.getElementById('bankName').value,
    phone:document.getElementById('phone').value,
    accountDisclosure:document.getElementById('accountDisclosure').value
  };

  try{
    const res=await fetch(ENDPOINT,{method:"POST",body:JSON.stringify(payload)});
    const data=await res.json();
    if(data.ok){
      alert("제출 완료! 담당자에게 전달되었습니다.");
    }else{
      alert("오류: "+data.error);
    }
  }catch(err){ alert("네트워크 오류: "+err.message); }
});
</script>
</body>
</html>
