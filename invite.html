<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ê²°í˜¼ì‹ ê¸°ë³¸ ì •ë³´</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;padding:24px;background:#f9f9f9;color:#111}
.card{max-width:720px;margin:0 auto;background:#fff;padding:24px;border-radius:16px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
h2{margin-top:0}
label{display:block;margin:12px 0 6px;font-weight:600}
input,select{width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
.row{display:flex;gap:8px}
.btn{padding:12px 16px;border:0;border-radius:8px;cursor:pointer;font-weight:600}
.btn.primary{background:#111;color:#fff;width:100%;margin-top:16px}
.btn.secondary{background:#eee}
.hint{font-size:12px;color:#666;margin-top:4px}
.preview{white-space:pre-wrap;border:1px solid #ddd;padding:16px;border-radius:12px;background:#fafafa;margin-top:16px}
.hidden{display:none}
.section{margin-top:24px;padding-top:16px;border-top:1px solid #eee}
</style>
</head>
<body>
<div class="card">
  <h2>ê²°í˜¼ì‹ ê¸°ë³¸ ì •ë³´</h2>

  <!-- Step 1: ëª¨ë°”ì¼ ì²­ì²©ì¥ -->
  <div class="section">
    <label>ëª¨ë°”ì¼ ì²­ì²©ì¥ URL *</label>
    <div class="row">
      <input id="inviteUrl" placeholder="https://..." required />
      <button class="btn secondary" id="btnExtract" type="button">ì •ë³´ ê°€ì ¸ì˜¤ê¸°</button>
    </div>
    <p class="hint">â€» ëª¨ë°”ì¼ ì²­ì²©ì¥ì´ ì—†ìœ¼ë©´ ì§ì ‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.</p>
  </div>

  <!-- Step 2: ì…ë ¥ì°½ (AI ê²°ê³¼ ìë™ ì±„ì›€) -->
  <div class="section">
    <label>ì‹ ë‘ì¸¡ *</label>
    <input id="groomInfo" placeholder="ì˜ˆ: ì„œê´‘í›ˆ âˆ™ ì •í˜„ìˆœ ì˜ ì•„ë“¤ í˜„ì¢…" />

    <label>ì‹ ë¶€ì¸¡ *</label>
    <input id="brideInfo" placeholder="ì˜ˆ: ìœ ì›í˜• âˆ™ ê¹€í¬ìˆ™ ì˜ ë”¸ ìŠ¹ì•„" />

    <label>ì˜ˆì‹ì¼ì‹œ *</label>
    <div class="row">
      <input type="date" id="eventDate" />
      <input type="time" id="eventTime" step="600" />
    </div>

    <label>ì˜ˆì‹ì¥ *</label>
    <input id="venue" placeholder="ì˜ˆ: ë¼ë§ˆë‹¤ ì„œìš¸ ì‹ ë„ë¦¼ í˜¸í…” ì„¸ì¸íŠ¸ê·¸ë ˆì´ìŠ¤í™€" />

    <label>ì˜ˆì‹ì¥ ì£¼ì†Œ *</label>
    <input id="venueAddr" placeholder="ì˜ˆ: ì„œìš¸ êµ¬ë¡œêµ¬ ê²½ì¸ë¡œ 624, TEL: 02-2162-2100" />

    <label>ìŠ¤ëª°ì›¨ë”© ì—¬ë¶€ *</label>
    <select id="isSmallWedding">
      <option value="">ì„ íƒ</option><option>ì˜ˆ</option><option>ì•„ë‹ˆì˜¤</option>
    </select>
  </div>

  <!-- Step 3: ë¯¸ë¦¬ë³´ê¸° -->
  <div class="section">
    <button type="button" class="btn secondary" id="btnPreview">ë¯¸ë¦¬ë³´ê¸°</button>
    <div id="previewBox" class="preview hidden"></div>
  </div>

  <!-- Step 4: ë‹¤ìŒ ë‹¨ê³„ -->
  <div class="section">
    <button class="btn primary" id="goWedding">ì¶”ê°€ ì •ë³´ ì…ë ¥</button>
  </div>
</div>

<script>
// ğŸš© Apps Script URL
const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

// AI ì •ë³´ ê°€ì ¸ì˜¤ê¸°
document.getElementById('btnExtract').addEventListener('click',async()=>{
  const url=document.getElementById('inviteUrl').value.trim();
  if(!url){ alert("URLì„ ì…ë ¥í•˜ì„¸ìš”."); return; }

  try{
    const res=await fetch(ENDPOINT+'?action=extract&url='+encodeURIComponent(url));
    const text=await res.text();
    const data=JSON.parse(text);

    if(data.ok){
      // ì…ë ¥ì¹¸ ìë™ ì±„ì›€
      document.getElementById('groomInfo').value=`${data.groomFather||''} âˆ™ ${data.groomMother||''} ì˜ ${data.groomorder||''} ${data.groomName||''}`;
      document.getElementById('brideInfo').value=`${data.brideFather||''} âˆ™ ${data.brideMother||''} ì˜ ${data.brideorder||''} ${data.brideName||''}`;
      document.getElementById('eventDate').value=data.eventDate||'';
      document.getElementById('eventTime').value=data.eventTime||'';
      document.getElementById('venue').value=data.venue||'';
      document.getElementById('venueAddr').value=data.venueAddr||'';
      alert("ì²­ì²©ì¥ ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì±„ì›Œì¡ŒìŠµë‹ˆë‹¤. í•„ìš”í•œ ê²½ìš° ìˆ˜ì •í•˜ì„¸ìš”.");
    }else{
      alert("ì¶”ì¶œ ì‹¤íŒ¨: ìˆ˜ê¸°ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
    }
  }catch(err){
    alert("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: "+err.message);
  }
});

// ë¯¸ë¦¬ë³´ê¸°
document.getElementById('btnPreview').addEventListener('click',()=>{
  const groom=document.getElementById('groomInfo').value.trim();
  const bride=document.getElementById('brideInfo').value.trim();
  const date=document.getElementById('eventDate').value;
  const time=document.getElementById('eventTime').value;
  const venue=document.getElementById('venue').value.trim();
  const addr=document.getElementById('venueAddr').value.trim();
  const small=document.getElementById('isSmallWedding').value;

  if(!groom||!bride||!date||!time||!venue||!addr){
    alert("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”."); return;
  }

  const preview=`${groom}
${bride}
â–¡ ì¼ ì‹œ : ${date} ${time}
â–¡ ì¥ ì†Œ : ${venue}
           (${addr})
â–¡ ìŠ¤ëª°ì›¨ë”© ì—¬ë¶€ : ${small||"ì„ íƒì•ˆí•¨"}`;

  document.getElementById('previewBox').textContent=preview;
  document.getElementById('previewBox').classList.remove('hidden');

  // wedding.htmlì— ë„˜ê¸¸ ë°ì´í„° ì €ì¥
  localStorage.setItem('inviteExtract',JSON.stringify({
    groomInfo:groom, brideInfo:bride,
    eventDate:date, eventTime:time,
    venue:venue, venueAddr:addr,
    isSmallWedding:small
  }));
});

// ë‹¤ìŒ ë‹¨ê³„
document.getElementById('goWedding').addEventListener('click',()=>{
  location.href='wedding.html';
});
</script>
</body>
</html>
