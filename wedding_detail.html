<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì¶”ê°€ ì •ë³´ ì…ë ¥</title>
<style>
body {
  font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  margin:0; padding:16px; background:#f9f9f9;
}
.card {
  max-width:420px; margin:0 auto; background:#fff;
  padding:16px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
h2 { margin:0 0 12px; font-size:18px }
.row {
  display:flex; align-items:center; gap:6px; margin:8px 0; flex-wrap:wrap;
}
.row label {
  flex:0 0 120px; font-size:14px; font-weight:600;
}
.row input, .row select {
  flex:1; min-width:0; padding:8px; font-size:14px;
  border:1px solid #ccc; border-radius:6px;
}
.btn {
  padding:10px; border:0; border-radius:6px; cursor:pointer;
  font-weight:600; font-size:14px; margin-top:10px;
}
.btn.primary { background:#111; color:#fff; width:100% }
.preview {
  white-space:pre-wrap; border:1px solid #ddd; padding:12px;
  border-radius:12px; background:#fafafa; margin-top:12px; font-size:14px;
}
.msg { margin-top:10px; display:none }
</style>
</head>
<body>
<div class="card">
  <h2>ì¶”ê°€ ì •ë³´ ì…ë ¥</h2>

  <div class="row">
    <label>ì„ì› ì„±í•¨ *</label>
    <input id="name">
  </div>

  <div class="row">
    <label>ì„ì›ì¸¡ *</label>
    <div>
      <label><input type="radio" name="parentSide" value="groom"> ì‹ ë‘ì¸¡</label>
      <label><input type="radio" name="parentSide" value="bride"> ì‹ ë¶€ì¸¡</label>
    </div>
  </div>

  <div class="row">
    <label>ì¬ì§/í‡´ì„ *</label>
    <select id="empStatus">
      <option value="">ì„ íƒ</option>
      <option>ì¬ì§</option>
      <option>í‡´ì„</option>
    </select>
  </div>

  <div class="row">
    <label>ê·¼ë¬´ ë¶€ì„œ *</label>
    <input id="deptWhenEmployed">
  </div>

  <div class="row">
    <label>ì§ì±… *</label>
    <input id="currentJobTitle">
  </div>

  <div class="row">
    <label>ì²­íƒê¸ˆì§€ë²• *</label>
    <select id="antiGraft">
      <option value="">ì„ íƒ</option>
      <option>ëŒ€ìƒ</option>
      <option>ë¹„ëŒ€ìƒ</option>
    </select>
  </div>

  <div class="row">
    <label>ì¶•ì˜ê³„ì¢Œ *</label>
    <input id="bankNumber">
  </div>

  <div class="row">
    <label>ì€í–‰ *</label>
    <select id="bankName">
      <option value="">ì„ íƒ</option>
      <option>êµ­ë¯¼</option><option>ì‹ í•œ</option><option>ìš°ë¦¬</option>
      <option>í•˜ë‚˜</option><option>ë†í˜‘</option><option>ê¸°ì—…</option>
    </select>
  </div>

  <div class="row">
    <label>ì—°ë½ì²˜ *</label>
    <input id="phone" placeholder="010-1234-5678">
  </div>

  <div class="row">
    <label>ê³„ì¢Œê³µê°œ *</label>
    <select id="accountDisclosure">
      <option value="">ì„ íƒ</option>
      <option>í¬ë§</option>
      <option>ë¹„í¬ë§</option>
    </select>
  </div>

  <button class="btn primary" id="btnPreview">ë¯¸ë¦¬ë³´ê¸°</button>
  <div id="previewBox" class="preview hidden"></div>

  <button class="btn primary" id="btnSubmit">ì œì¶œ</button>
  <div id="submitMessage" class="msg"></div>
</div>

<script>
const invite = JSON.parse(localStorage.getItem('inviteInfo') || '{}');
const phone = document.getElementById('phone');

// ì „í™”ë²ˆí˜¸ ìë™ í•˜ì´í”ˆ
phone.addEventListener('input', e => {
  let v = e.target.value.replace(/\D/g, "");
  if (v.length === 10) v = v.replace(/(\d{2,3})(\d{3,4})(\d{4})/, "$1-$2-$3");
  else if (v.length === 11) v = v.replace(/(\d{3})(\d{4})(\d{4})/, "$1-$2-$3");
  e.target.value = v;
});

function formatDateTime(d, t) {
  try {
    const w = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
    const dd = new Date(`${d}T${t}`);
    let h = dd.getHours(), m = ("0"+dd.getMinutes()).slice(-2);
    const ap = h < 12 ? "ì˜¤ì „" : "ì˜¤í›„";
    if (h === 0) h = 12; else if (h > 12) h -= 12;
    return `${dd.getFullYear()}ë…„ ${dd.getMonth()+1}ì›” ${dd.getDate()}ì¼ ${w[dd.getDay()]}ìš”ì¼ ${ap} ${h}ì‹œ ${m}ë¶„`;
  } catch { return d + " " + t }
}

// ğŸŸ¢ ë¯¸ë¦¬ë³´ê¸°
document.getElementById('btnPreview').addEventListener('click', () => {
  const side = document.querySelector('input[name="parentSide"]:checked')?.value;
  const emp = document.getElementById('empStatus').value;
  const dept = document.getElementById('deptWhenEmployed').value;
  const nm = document.getElementById('name').value;
  const job = document.getElementById('currentJobTitle').value;
  const ph = phone.value;
  const bank = document.getElementById('bankName').value;
  const bankNum = document.getElementById('bankNumber').value;
  const anti = document.getElementById('antiGraft').value;

  let header = emp === "ì¬ì§"
    ? `<div style="font-size:14pt"><b>ì‚¼ì„±ì „ì ${dept} ${nm} ${job} ${side==="groom"?invite.groomOrder:invite.brideOrder}ê²°í˜¼</b>ì„ ì•ˆë‚´í•˜ì˜¤ë‹ˆ<br>ë§ì€ ì¶•í•˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div><br>`
    : `<div style="font-size:14pt"><b>ì „)ì‚¼ì„±ì „ì ${dept} ${nm} ${job} ${side==="groom"?invite.groomOrder:invite.brideOrder}ê²°í˜¼</b>ì„ ì•ˆë‚´í•˜ì˜¤ë‹ˆ<br>ë§ì€ ì¶•í•˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div><br>`;

  let family = side === "groom"
    ? `<div style="font-size:16pt;font-weight:bold">${invite.groomFather} Â· ${invite.groomMother} ì˜ ${invite.groomOrder} ${invite.groomName}</div>
       <div style="font-size:16pt">${invite.brideFather} Â· ${invite.brideMother} ì˜ ${invite.brideOrder} ${invite.brideName}</div><br>`
    : `<div style="font-size:16pt;font-weight:bold">${invite.brideFather} Â· ${invite.brideMother} ì˜ ${invite.brideOrder} ${invite.brideName}</div>
       <div style="font-size:16pt">${invite.groomFather} Â· ${invite.groomMother} ì˜ ${invite.groomOrder} ${invite.groomName}</div><br>`;

  let schedule =
    `<div style="font-size:12pt">â–¡ ì¼ ì‹œ : ${formatDateTime(invite.eventDate,invite.eventTime)}<br>
     â–¡ ì¥ ì†Œ : ${invite.venueDetail}<br>
     &nbsp;&nbsp;&nbsp;&nbsp;(${invite.venueAddr})<br>
     â–¡ ì—°ë½ì²˜ : ${ph} (${nm} ${job})<br>
     â–¡ ì¶•ì˜ê¸ˆ ì „ë‹¬ê³„ì¢Œ : ${bank} ${bankNum} (${nm})</div><br>`;

  let sw = invite.isSmallWedding==="ì˜ˆ"
    ? `<div style="font-size:12pt">â€» ì‘ì€ ê²°í˜¼ì‹ì¸ ê´€ê³„ë¡œ ê°€ì¡± ë° ì¹œì§€ë¥¼ ì´ˆì²­í•˜ì—¬ ì§„í–‰í•˜ì˜¤ë‹ˆ ì–‘í•´ë°”ëë‹ˆë‹¤.</div>` : "";

  let graft = anti==="ëŒ€ìƒ"
    ? `<div style="font-size:12pt">â€» ì²­íƒê¸ˆì§€ë²• ëŒ€ìƒ</div>`
    : anti==="ë¹„ëŒ€ìƒ"
      ? `<div style="font-size:12pt">â€» ì²­íƒê¸ˆì§€ë²• ë¹„ëŒ€ìƒ</div>` : "";

  document.getElementById('previewBox').innerHTML =
    `<div style="font-family:Batang;line-height:1.6">${header}${family}${schedule}${sw}${graft}</div>`;
  document.getElementById('previewBox').classList.remove('hidden');
});

// ğŸŸ¢ ì œì¶œ
document.getElementById('btnSubmit').addEventListener('click', async () => {
  const payload = {
    ...invite,
    name: document.getElementById('name').value,
    parentSide: document.querySelector('input[name="parentSide"]:checked')?.value,
    empStatus: document.getElementById('empStatus').value,
    deptWhenEmployed: document.getElementById('deptWhenEmployed').value,
    currentJobTitle: document.getElementById('currentJobTitle').value,
    antiGraft: document.getElementById('antiGraft').value,
    bankNumber: document.getElementById('bankNumber').value,
    bankName: document.getElementById('bankName').value,
    phone: phone.value,
    accountDisclosure: document.getElementById('accountDisclosure').value
  };

  const ENDPOINT = "https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";
  const msg = document.getElementById("submitMessage");

  try {
    const res = await fetch(ENDPOINT, {
      method:"POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(payload),
      mode:"cors"
    });
    const data = await res.json();
    if (data.ok) {
      msg.innerHTML = "ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì˜ˆì‹ì¼ ê¸°ì¤€ 2~3ì£¼ ë‚´ ê²Œì‹œ ì˜ˆì •ì…ë‹ˆë‹¤.<br>â€» í•„ìš” ì‹œ ë‹´ë‹¹ìê°€ ê°œë³„ ì—°ë½ë“œë¦½ë‹ˆë‹¤.";
      msg.style.color = "green";
    } else {
      msg.innerHTML = "ì œì¶œ ì‹¤íŒ¨: " + (data.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
      msg.style.color = "red";
    }
  } catch(err) {
    msg.innerHTML = "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: " + err.message;
    msg.style.color = "red";
  }
  msg.style.display="block";
});
</script>
</body>
</html>
