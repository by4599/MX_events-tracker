<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì¶”ê°€ ì •ë³´ ì…ë ¥</title>
<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  margin:0;padding:16px;background:#f9f9f9;color:#111
}
.card{
  max-width:420px;
  margin:0 auto;background:#fff;padding:16px;
  border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1)
}
h2{margin-top:0;font-size:18px}
.row-inline{
  display:flex;align-items:center;gap:6px;margin:8px 0;
  flex-wrap:wrap;
}
.row-inline label{
  flex:0 0 120px;font-size:14px;font-weight:600
}
.row-inline input,.row-inline select{
  flex:1;min-width:0;
  padding:8px;font-size:14px;
  border:1px solid #ccc;border-radius:6px
}
.btn{
  padding:10px 12px;border:0;border-radius:6px;
  cursor:pointer;font-weight:600;font-size:14px
}
.btn.primary{background:#111;color:#fff;width:100%;margin-top:12px}
.preview{white-space:pre-wrap;border:1px solid #ddd;padding:12px;border-radius:12px;background:#fafafa;margin-top:12px;font-size:14px}
.hidden{display:none}
</style>
</head>
<body>
<div class="card">
  <h2>ì¶”ê°€ ì •ë³´ ì…ë ¥</h2>

  <div class="row-inline"><label>ì„ì› ì„±í•¨ *</label><input id="name" /></div>
  <div class="row-inline">
    <label>ì„ì›ì¸¡ *</label>
    <div>
      <label><input type="radio" name="parentSide" value="groom"> ì‹ ë‘ì¸¡</label>
      <label><input type="radio" name="parentSide" value="bride"> ì‹ ë¶€ì¸¡</label>
    </div>
  </div>
  <div class="row-inline">
    <label>ì¬ì§/í‡´ì§ *</label>
    <select id="empStatus"><option value="">ì„ íƒ</option><option>ì¬ì§</option><option>í‡´ì„</option></select>
  </div>
  <div class="row-inline"><label>ê·¼ë¬´ ë¶€ì„œ *</label><input id="deptWhenEmployed" /></div>
  <div class="row-inline"><label>ì§ì±… *</label><input id="currentJobTitle" /></div>
  <div class="row-inline">
    <label>ì²­íƒê¸ˆì§€ë²• *</label>
    <select id="antiGraft"><option value="">ì„ íƒ</option><option>ëŒ€ìƒ</option><option>ë¹„ëŒ€ìƒ</option></select>
  </div>
  <div class="row-inline"><label>ì¶•ì˜ê³„ì¢Œ *</label><input id="bankNumber" /></div>
  <div class="row-inline">
    <label>ì€í–‰ *</label>
    <select id="bankName">
      <option value="">ì„ íƒ</option><option>êµ­ë¯¼</option><option>ì‹ í•œ</option><option>ìš°ë¦¬</option>
      <option>í•˜ë‚˜</option><option>ë†í˜‘</option><option>ê¸°ì—…</option>
    </select>
  </div>
  <div class="row-inline"><label>ì—°ë½ì²˜ *</label><input id="phone" placeholder="010-1234-5678" /></div>
  <div class="row-inline">
    <label>ê³„ì¢Œê³µê°œ *</label>
    <select id="accountDisclosure"><option value="">ì„ íƒ</option><option>í¬ë§</option><option>ë¹„í¬ë§</option></select>
  </div>

  <button class="btn primary" id="btnPreview">ê²Œì‹œê¸€ ë¯¸ë¦¬ë³´ê¸°</button>
  <div id="previewBox" class="preview hidden"></div>
  <button class="btn primary" id="btnSubmit">ì œì¶œ</button>
</div>

<script>
const invite=JSON.parse(localStorage.getItem('inviteInfo')||'{}');

// ğŸŸ¢ ì „í™”ë²ˆí˜¸ ìë™ í•˜ì´í”ˆ (ì—°ë½ì²˜ input)
document.getElementById('phone').addEventListener('input',(e)=>{
  let num=e.target.value.replace(/\D/g,"");
  if(num.length===10){
    num=num.replace(/(\d{2,3})(\d{3,4})(\d{4})/,"$1-$2-$3");
  }else if(num.length===11){
    num=num.replace(/(\d{3})(\d{4})(\d{4})/,"$1-$2-$3");
  }
  e.target.value=num;
});

// ğŸŸ¢ ì˜ˆì‹ì¥ ì£¼ì†Œ ë‚´ ì „í™”ë²ˆí˜¸ ìë™ í•˜ì´í”ˆ
function formatVenueAddr(rawAddr){
  const telMatch=rawAddr.match(/(\d{2,4})[- ]?(\d{3,4})[- ]?(\d{4})/);
  if(telMatch){
    const tel=telMatch[1]+"-"+telMatch[2]+"-"+telMatch[3];
    return rawAddr.replace(telMatch[0],tel);
  }
  return rawAddr;
}

// ğŸŸ¢ ì„± ì¶”ì¶œ/ìë…€ ì´ë¦„ ë³´ì •
const compoundSurnames=["ë‚¨ê¶","í™©ë³´","ì œê°ˆ","ì‚¬ê³µ","ì„ ìš°","ì„œë¬¸","ë…ê³ ","ë™ë°©"];

function extractSurname(fatherName){
  if(!fatherName) return "";
  const firstTwo=fatherName.slice(0,2);
  if(compoundSurnames.includes(firstTwo)) return firstTwo;
  return fatherName[0];
}

function getChildName(fatherName, childName){
  if(!childName) return "";
  const surname=extractSurname(fatherName);
  if(surname && childName.startsWith(surname)){
    return childName.slice(surname.length); // ì„± ì œê±°
  }
  return childName; // ì„± ì—†ìŒ â†’ ê·¸ëŒ€ë¡œ
}

function formatDateTime(dateStr, timeStr){
  try{
    const days=["ì¼ìš”ì¼","ì›”ìš”ì¼","í™”ìš”ì¼","ìˆ˜ìš”ì¼","ëª©ìš”ì¼","ê¸ˆìš”ì¼","í† ìš”ì¼"];
    const d=new Date(`${dateStr}T${timeStr}`);
    const y=d.getFullYear(), m=d.getMonth()+1, day=d.getDate(), dow=days[d.getDay()];
    let hour=d.getHours(), min=("0"+d.getMinutes()).slice(-2);
    const ampm=hour<12?"ì˜¤ì „":"ì˜¤í›„";
    if(hour===0) hour=12;
    else if(hour>12) hour-=12;
    return `${y}ë…„ ${m}ì›” ${day}ì¼ ${dow} ${ampm} ${hour}ì‹œ ${min}ë¶„`;
  }catch{ return dateStr+" "+timeStr; }
}

// ğŸŸ¢ ë¯¸ë¦¬ë³´ê¸°
document.getElementById('btnPreview').addEventListener('click',()=>{
  const side=document.querySelector('input[name="parentSide"]:checked')?.value;
  const empStatus=document.getElementById('empStatus').value;
  const dept=document.getElementById('deptWhenEmployed').value;
  const name=document.getElementById('name').value;
  const job=document.getElementById('currentJobTitle').value;
  const phone=document.getElementById('phone').value;
  const bank=document.getElementById('bankName').value;
  const bankNum=document.getElementById('bankNumber').value;
  const anti=document.getElementById('antiGraft').value;

  // ì„ì› header
  let header="";
  if(empStatus==="ì¬ì§"){
    header=`<div style="font-size:14pt"><b>ì‚¼ì„±ì „ì ${dept} ${name} ${job} ${side==="groom"?invite.groomOrder:invite.brideOrder}ê²°í˜¼</b>ì„ ì•ˆë‚´í•˜ì˜¤ë‹ˆ<br>ë§ì€ ì¶•í•˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div><br>`;
  }else{
    header=`<div style="font-size:14pt"><b>ì „)ì‚¼ì„±ì „ì ${dept} ${name} ${job} ${side==="groom"?invite.groomOrder:invite.brideOrder}ê²°í˜¼</b>ì„ ì•ˆë‚´í•˜ì˜¤ë‹ˆ<br>ë§ì€ ì¶•í•˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</div><br>`;
  }

  // í˜¼ì£¼ block (ì„±ì´ ìˆì„ ê²½ìš°ì—ë§Œ ì œê±°)
  let familyBlock="";
  if(side==="groom"){
    familyBlock=`<div style="font-size:16pt;font-weight:bold">`+
      `${invite.groomFather} Â· ${invite.groomMother} ì˜ ${invite.groomOrder} ${getChildName(invite.groomFather, invite.groomName)}</div>`+
      `<div style="font-size:16pt">`+
      `${invite.brideFather} Â· ${invite.brideMother} ì˜ ${invite.brideOrder} ${getChildName(invite.brideFather, invite.brideName)}</div><br>`;
  }else{
    familyBlock=`<div style="font-size:16pt;font-weight:bold">`+
      `${invite.brideFather} Â· ${invite.brideMother} ì˜ ${invite.brideOrder} ${getChildName(invite.brideFather, invite.brideName)}</div>`+
      `<div style="font-size:16pt">`+
      `${invite.groomFather} Â· ${invite.groomMother} ì˜ ${invite.groomOrder} ${getChildName(invite.groomFather, invite.groomName)}</div><br>`;
  }

  // ì¼ì • ë° ì£¼ì†Œ
  let schedule=`<div style="font-size:12pt">`+
    `â–¡ ì¼ ì‹œ : ${formatDateTime(invite.eventDate,invite.eventTime)}<br>`+
    `â–¡ ì¥ ì†Œ : ${invite.venueDetail}<br>`+
    `&nbsp;&nbsp;&nbsp;&nbsp;(${formatVenueAddr(invite.venueAddr)})<br>`+
    `â–¡ ì—°ë½ì²˜ : ${phone} (${name} ${job})<br>`+
    `â–¡ ì¶•ì˜ê¸ˆ ì „ë‹¬ê³„ì¢Œ : ${bank}ì€í–‰ ${bankNum} (${name})</div><br>`;

  // ìŠ¤ëª°ì›¨ë”© ì—¬ë¶€
  let smallWedding="";
  if(invite.isSmallWedding==="ì˜ˆ"){
    smallWedding=`<div style="font-size:12pt">â€» ì‘ì€ ê²°í˜¼ì‹ì¸ ê´€ê³„ë¡œ ê°€ì¡± ë° ì¹œì§€ë¥¼ ì´ˆì²­í•˜ì—¬ ì§„í–‰í•˜ì˜¤ë‹ˆ ì–‘í•´ë°”ëë‹ˆë‹¤.</div><br>`;
  }

  // ì²­íƒê¸ˆì§€ë²•
  let graftNote="";
  if(anti==="ëŒ€ìƒ"){
    graftNote=`<div style="font-size:12pt">â€» ì²­íƒê¸ˆì§€ë²• ëŒ€ìƒ</div>`;
  }else if(anti==="ë¹„ëŒ€ìƒ"){
    graftNote=`<div style="font-size:12pt">â€» ì²­íƒê¸ˆì§€ë²• ë¹„ëŒ€ìƒ</div>`;
  }

  const preview=
    `<div style="font-family:Batang;line-height:1.6">`+
    `${header}${familyBlock}${schedule}${smallWedding}${graftNote}</div>`;

  document.getElementById('previewBox').innerHTML=preview;
  document.getElementById('previewBox').classList.remove('hidden');
});
</script>
</body>
</html>
