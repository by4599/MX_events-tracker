<!doctype html> 
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>추가 정보 입력</title>
<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  margin:0;padding:16px;background:#f9f9f9;color:#111
}
.card{
  max-width:420px;
  margin:0 auto;background:#fff;padding:16px;
  border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1)
}
h2{margin-top:0;font-size:18px}
.row-inline{
  display:flex;align-items:center;gap:6px;margin:8px 0;
  flex-wrap:wrap;
}
.row-inline label{
  flex:0 0 120px;font-size:14px;font-weight:600
}
.row-inline input,.row-inline select{
  flex:1;min-width:0;
  padding:8px;font-size:14px;
  border:1px solid #ccc;border-radius:6px
}
.btn{
  padding:10px 12px;border:0;border-radius:6px;
  cursor:pointer;font-weight:600;font-size:14px
}
.btn.primary{background:#111;color:#fff;width:100%;margin-top:12px}
.preview{white-space:pre-wrap;border:1px solid #ddd;padding:12px;border-radius:12px;background:#fafafa;margin-top:12px;font-size:14px}
.hidden{display:none}
#submitMessage{
  margin-top:12px;
  padding:10px;
  font-size:13px;
  color:#0a6d0a;
  background:#e9f8e9;
  border:1px solid #b5e0b5;
  border-radius:8px;
  line-height:1.5;
  display:none;
}
</style>
</head>
<body>
<div class="card">
  <h2>추가 정보 입력</h2>

  <div class="row-inline"><label>임원 성함 *</label><input id="name" /></div>
  <div class="row-inline">
    <label>임원측 *</label>
    <div>
      <label><input type="radio" name="parentSide" value="groom"> 신랑측</label>
      <label><input type="radio" name="parentSide" value="bride"> 신부측</label>
    </div>
  </div>
  <div class="row-inline">
    <label>재직/퇴직 *</label>
    <select id="empStatus"><option value="">선택</option><option>재직</option><option>퇴임</option></select>
  </div>
  <div class="row-inline"><label>근무 부서 *</label><input id="deptWhenEmployed" /></div>
  <div class="row-inline"><label>직책 *</label><input id="currentJobTitle" /></div>
  <div class="row-inline">
    <label>청탁금지법 *</label>
    <select id="antiGraft"><option value="">선택</option><option>대상</option><option>비대상</option></select>
  </div>
  <div class="row-inline"><label>축의계좌 *</label><input id="bankNumber" /></div>
  <div class="row-inline">
    <label>은행 *</label>
    <select id="bankName">
      <option value="">선택</option><option>국민</option><option>신한</option><option>우리</option>
      <option>하나</option><option>농협</option><option>기업</option>
    </select>
  </div>
  <div class="row-inline"><label>연락처 *</label><input id="phone" placeholder="010-1234-5678" /></div>
  <div class="row-inline">
    <label>계좌공개 *</label>
    <select id="accountDisclosure"><option value="">선택</option><option>희망</option><option>비희망</option></select>
  </div>

  <button class="btn primary" id="btnPreview">게시글 미리보기</button>
  <div id="previewBox" class="preview hidden"></div>
  <button class="btn primary" id="btnSubmit">제출</button>
  <div id="submitMessage"></div> <!-- ✅ 제출 완료 메시지 표시 영역 -->
</div>

<script>
const invite=JSON.parse(localStorage.getItem('inviteInfo')||'{}');

// 전화번호 자동 하이픈
document.getElementById('phone').addEventListener('input',(e)=>{
  let num=e.target.value.replace(/\D/g,"");
  if(num.length===10){
    num=num.replace(/(\d{2,3})(\d{3,4})(\d{4})/,"$1-$2-$3");
  }else if(num.length===11){
    num=num.replace(/(\d{3})(\d{4})(\d{4})/,"$1-$2-$3");
  }
  e.target.value=num;
});

// 제출 이벤트
document.getElementById('btnSubmit').addEventListener('click', async () => {
  const payload = {
    ...invite,
    name: document.getElementById('name').value,
    parentSide: document.querySelector('input[name="parentSide"]:checked')?.value,
    empStatus: document.getElementById('empStatus').value,
    deptWhenEmployed: document.getElementById('deptWhenEmployed').value,
    currentJobTitle: document.getElementById('currentJobTitle').value,
    antiGraft: document.getElementById('antiGraft').value,
    bankNumber: document.getElementById('bankNumber').value,
    bankName: document.getElementById('bankName').value,
    phone: document.getElementById('phone').value,
    accountDisclosure: document.getElementById('accountDisclosure').value
  };

  // 필수값 검증
  if (!payload.name || !payload.parentSide || !payload.empStatus || 
      !payload.deptWhenEmployed || !payload.currentJobTitle || 
      !payload.antiGraft || !payload.bankNumber || !payload.bankName || 
      !payload.phone || !payload.accountDisclosure) {
    alert("필수 입력값을 모두 채워주세요.");
    return;
  }

  const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

  try {
    const res = await fetch(ENDPOINT, {
      method:"POST",
      body: JSON.stringify(payload),
      headers: { "Content-Type":"application/json" }
    });
    const data = await res.json();
    const msgBox=document.getElementById("submitMessage");
    if (data.ok) {
      msgBox.innerHTML=`신청이 완료되었습니다.<br>
      예식일 기준 2~3주 이내 게시 예정이며,<br>
      신속 게시를 원하실 경우 경조사 담당자에게 문의해 주시기 바랍니다.<br>
      ※ 추가 확인 사항은 담당자가 개별 연락드립니다. (카카오톡 채널 확인 가능)`;
      msgBox.style.display="block";
    } else {
      msgBox.innerHTML="❌ 제출 실패: "+(data.error || "알 수 없는 오류");
      msgBox.style.color="red";
      msgBox.style.display="block";
    }
  } catch (err) {
    const msgBox=document.getElementById("submitMessage");
    msgBox.innerHTML="❌ 제출 중 오류 발생: "+err.message;
    msgBox.style.color="red";
    msgBox.style.display="block";
  }
});
</script>
</body>
</html>
