<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì¶”ê°€ ì •ë³´ ì…ë ¥</title>
<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  margin:0;padding:16px;background:#f9f9f9;color:#111
}
.card{
  max-width:420px;
  margin:0 auto;background:#fff;padding:16px;
  border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1)
}
h2{margin-top:0;font-size:18px}
h3{margin:12px 0;font-size:16px}
.row-inline{
  display:flex;align-items:center;gap:6px;margin:8px 0;
  flex-wrap:wrap;
}
.row-inline label{
  flex:0 0 120px;font-size:14px;font-weight:600
}
.row-inline input,.row-inline select{
  flex:1;min-width:0;
  padding:8px;font-size:14px;
  border:1px solid #ccc;border-radius:6px
}
.btn{
  padding:10px 12px;border:0;border-radius:6px;
  cursor:pointer;font-weight:600;font-size:14px
}
.btn.primary{background:#111;color:#fff;width:100%;margin-top:12px}
.preview{white-space:pre-wrap;border:1px solid #ddd;padding:12px;border-radius:12px;background:#fafafa;margin-top:12px;font-size:14px}
.hidden{display:none}
.note{font-size:12px;color:#666;margin-top:2px}
</style>
</head>
<body>
<div class="card">
  <h2>ì¶”ê°€ ì •ë³´ ì…ë ¥</h2>

  <div class="row-inline"><label>ì„ì› ì„±í•¨ *</label><input id="name" /></div>
  <div class="row-inline">
    <label>ì¬ì§/í‡´ì§ *</label>
    <select id="empStatus"><option value="">ì„ íƒ</option><option>ì¬ì§</option><option>í‡´ì§</option></select>
  </div>
  <div class="row-inline"><label>ê·¼ë¬´ ë¶€ì„œ *</label><input id="deptWhenEmployed" /></div>
  <div class="row-inline"><label>í˜„ ì§ì¥/ì§ì±… *</label><input id="currentJobTitle" /></div>
  <div class="row-inline">
    <label>ì²­íƒê¸ˆì§€ë²• *</label>
    <select id="antiGraft"><option value="">ì„ íƒ</option><option>ëŒ€ìƒ</option><option>ë¹„ëŒ€ìƒ</option></select>
  </div>
  <div class="row-inline"><label>ì¶•ì˜ê³„ì¢Œ *</label><input id="bankNumber" /></div>
  <div class="row-inline">
    <label>ì€í–‰ *</label>
    <select id="bankName">
      <option value="">ì„ íƒ</option><option>êµ­ë¯¼</option><option>ì‹ í•œ</option><option>ìš°ë¦¬</option>
      <option>í•˜ë‚˜</option><option>ë†í˜‘</option><option>ê¸°ì—…</option>
    </select>
  </div>
  <div class="row-inline"><label>ì—°ë½ì²˜ *</label><input id="phone" placeholder="010-1234-5678" /></div>
  <div class="row-inline">
    <label>ê³„ì¢Œê³µê°œ *</label>
    <select id="accountDisclosure"><option value="">ì„ íƒ</option><option>í¬ë§</option><option>ë¹„í¬ë§</option></select>
  </div>

  <button class="btn primary" id="btnPreview">ê²Œì‹œê¸€ ë¯¸ë¦¬ë³´ê¸°</button>
  <div id="previewBox" class="preview hidden"></div>
  <button class="btn primary" id="btnSubmit">ì œì¶œ</button>
</div>

<script>
const invite=JSON.parse(localStorage.getItem('inviteInfo')||'{}');

// ğŸŸ¢ ì „í™”ë²ˆí˜¸ ìë™ í•˜ì´í”ˆ
document.getElementById('phone').addEventListener('input',(e)=>{
  let num=e.target.value.replace(/\D/g,"");
  if(num.length===10){
    num=num.replace(/(\d{2,3})(\d{3,4})(\d{4})/,"$1-$2-$3");
  }else if(num.length===11){
    num=num.replace(/(\d{3})(\d{4})(\d{4})/,"$1-$2-$3");
  }
  e.target.value=num;
});

// ğŸŸ¢ ë¯¸ë¦¬ë³´ê¸°
document.getElementById('btnPreview').addEventListener('click',()=>{
  const name=document.getElementById('name').value;
  const job=document.getElementById('currentJobTitle').value;
  const phone=document.getElementById('phone').value;
  const bank=document.getElementById('bankName').value;
  const bankNum=document.getElementById('bankNumber').value;

  const preview=`${invite.groomFather} âˆ™ ${invite.groomMother} ì˜ ${invite.groomOrder} ${invite.groomName}
${invite.brideFather} âˆ™ ${invite.brideMother} ì˜ ${invite.brideOrder} ${invite.brideName}
â–¡ ì¼ ì‹œ : ${invite.eventDate} ${invite.eventTime}
â–¡ ì¥ ì†Œ : ${invite.venueAddr} ${invite.venueDetail}
â–¡ ì—°ë½ì²˜ : ${phone} (${name} ${job})
â–¡ ì¶•ì˜ê³„ì¢Œ : ${bank} ${bankNum} (${name})
â–¡ ìŠ¤ëª°ì›¨ë”© ì—¬ë¶€ : ${invite.isSmallWedding}
â–¡ í™”í™˜ ìˆ˜ë ¹ : ${invite.flowerOption}
â–¡ ì²­ì²©ì¥ URL : ${invite.noInvite?"ì—†ìŒ":invite.inviteUrl}`;

  document.getElementById('previewBox').textContent=preview;
  document.getElementById('previewBox').classList.remove('hidden');
});

// ğŸŸ¢ ì œì¶œ
document.getElementById('btnSubmit').addEventListener('click',async()=>{
  const required=[
    {id:'name',label:'ì„ì› ì„±í•¨'},
    {id:'empStatus',label:'ì¬ì§/í‡´ì§'},
    {id:'deptWhenEmployed',label:'ê·¼ë¬´ ë¶€ì„œ'},
    {id:'currentJobTitle',label:'í˜„ ì§ì¥/ì§ì±…'},
    {id:'antiGraft',label:'ì²­íƒê¸ˆì§€ë²•'},
    {id:'bankNumber',label:'ì¶•ì˜ê³„ì¢Œ'},
    {id:'bankName',label:'ì€í–‰'},
    {id:'phone',label:'ì—°ë½ì²˜'},
    {id:'accountDisclosure',label:'ê³„ì¢Œê³µê°œ'}
  ];
  for(const f of required){
    const val=document.getElementById(f.id).value.trim();
    if(!val){
      alert(`${f.label} í•­ëª©ì„ ì…ë ¥/ì„ íƒí•´ ì£¼ì„¸ìš”.`);
      document.getElementById(f.id).focus();
      return;
    }
  }

  const payload={
    ...invite,
    name:document.getElementById('name').value,
    empStatus:document.getElementById('empStatus').value,
    deptWhenEmployed:document.getElementById('deptWhenEmployed').value,
    currentJobTitle:document.getElementById('currentJobTitle').value,
    antiGraft:document.getElementById('antiGraft').value,
    bankNumber:document.getElementById('bankNumber').value,
    bankName:document.getElementById('bankName').value,
    phone:document.getElementById('phone').value,
    accountDisclosure:document.getElementById('accountDisclosure').value
  };

  const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";
  try{
    const res=await fetch(ENDPOINT,{method:"POST",body:JSON.stringify(payload)});
    const result=await res.json();
    if(result.ok){
      alert("ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ âœ…");
    }else{
      alert("ì œì¶œ ì‹¤íŒ¨: "+(result.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
    }
  }catch(err){
    alert("ì˜¤ë¥˜: "+err.message);
  }
});
</script>
</body>
</html>
