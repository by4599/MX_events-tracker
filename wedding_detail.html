<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì¶”ê°€ ì •ë³´ ì…ë ¥</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;padding:16px;background:#f9f9f9;color:#111}
    .card{max-width:420px;margin:0 auto;background:#fff;padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    h1{margin:0 0 6px 0;font-size:18px}
    h3{margin:12px 0 8px 0;font-size:16px;font-weight:800}
    label{display:block;margin:8px 0 4px;font-weight:600;font-size:14px}
    .help{font-size:12px;color:#8a8a8a;margin-top:6px}
    .section{margin-top:16px;padding-top:0}
    .hidden{display:none !important}
    .error{color:#b91c1c;font-size:12px;margin-top:6px}
    .muted{color:#8a8a8a}

    input[type="text"],input[type="tel"],select{
      width:100%;padding:10px 12px;font-size:14px;border:1.5px solid #ddd;border-radius:8px;background:#fff;
      transition:.2s;outline:none;box-sizing:border-box
    }
    input::placeholder{color:#aaa;font-size:13px}
    input:focus,select:focus{border-color:#111;box-shadow:0 0 0 3px rgba(17,17,17,.08)}
    .row{display:flex;gap:6px;flex-wrap:wrap}
    .col{flex:1 1 180px}

    .btn{padding:10px 12px;border:0;border-radius:6px;cursor:pointer;font-weight:600;font-size:14px}
    .btn.primary{background:#111;color:#fff}
    .btn.ghost{background:transparent;border:1.5px solid #ddd}
    .btn.full{width:100%}
    .btn.disabled{opacity:.5;cursor:not-allowed}

    .seg{display:flex;gap:6px;flex-wrap:wrap}
    .seg__btn{flex:1;padding:10px 12px;border:1.5px solid #ddd;border-radius:6px;background:#fff;font-weight:600;font-size:14px;cursor:pointer}
    .seg__btn[aria-pressed="true"],.seg__btn.is-selected{background:#111;color:#fff;border-color:#111}

    dialog{border:none;border-radius:12px;max-width:420px;width:calc(100% - 24px);padding:0}
    dialog .dlg-body{padding:16px}
    dialog .dlg-head{padding:12px 16px;font-weight:700}
    dialog .dlg-foot{padding:12px 16px;display:flex;gap:8px;justify-content:flex-end}

    .footer{display:flex;justify-content:center;gap:8px;margin-top:12px}
  </style>
</head>
<body>
  <div class="card" role="region" aria-label="ì¶”ê°€ ì •ë³´ ì…ë ¥">
    <h1>ì¶”ê°€ ì •ë³´ ì…ë ¥</h1>
    <p class="help">ì•„ë˜ ë‹¨ê³„ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì—´ë¦½ë‹ˆë‹¤</p>

    <!-- ì¸¡ ì„ íƒ -->
    <section class="section" id="sec-side">
      <div class="seg" role="group" aria-label="ì‹ ë‘ì¸¡/ì‹ ë¶€ì¸¡ ì„ íƒ">
        <button type="button" class="seg__btn" id="btn-groom-side" data-side="groom" aria-pressed="false">ì‹ ë‘ì¸¡</button>
        <button type="button" class="seg__btn" id="btn-bride-side" data-side="bride" aria-pressed="false">ì‹ ë¶€ì¸¡</button>
      </div>
    </section>

    <!-- ì„±í•¨ ì„ íƒ -->
    <section class="section hidden" id="sec-person">
      <h3>ì„±í•¨ ì„ íƒ</h3>
      <div class="seg" role="group" aria-label="ì•„ë²„ì§€/ì–´ë¨¸ë‹ˆ/ë³¸ì¸ ì„ íƒ">
        <button type="button" class="seg__btn" id="btn-father" data-person="father" aria-pressed="false">ì•„ë²„ì§€</button>
        <button type="button" class="seg__btn" id="btn-mother" data-person="mother" aria-pressed="false">ì–´ë¨¸ë‹ˆ</button>
        <button type="button" class="seg__btn" id="btn-self" data-person="self" aria-pressed="false">ë³¸ì¸</button>
      </div>
    </section>

    <!-- ì‚¼ì„±ì „ì ì¬ì§ì—¬ë¶€ -->
    <section class="section hidden" id="sec-status">
      <h3>ì‚¼ì„±ì „ì ì¬ì§ì—¬ë¶€</h3>
      <div class="seg" role="group" aria-label="ì¬ì§/í‡´ì„ ì„ íƒ">
        <button type="button" class="seg__btn" data-status="ì¬ì§" id="btn-onjob" aria-pressed="false">ì¬ì§</button>
        <button type="button" class="seg__btn" data-status="í‡´ì„" id="btn-retire" aria-pressed="false">í‡´ì„</button>
      </div>
    </section>

    <!-- (ì¬ì§ì‹œ) ê·¼ë¬´ ë¶€ì„œ/ì§ì±…  -->
    <section class="section hidden" id="sec-onjob">
      <div class="row">
        <div class="col">
          <label id="lbl-dept">ê·¼ë¬´ ë¶€ì„œ<span class="req">*</span></label>
          <input type="text" id="dept" placeholder="ì˜ˆ) MXê¸°íšíŒ€" autocomplete="organization" />
        </div>
        <div class="col">
          <label id="lbl-title">ì§ì±…<span class="req">*</span></label>
          <input type="text" id="title" placeholder="ì˜ˆ) ë¶€ì¥" autocomplete="organization-title" />
        </div>
      </div>
    </section>

    <!-- (í‡´ì„ì‹œ) í˜„ì§ì¥ ë° ì§ì±… -->
    <section class="section hidden" id="sec-retire">
      <h3>í˜„ì§ì¥ ë° ì§ì±…</h3>
      <input type="text" id="curCombined" placeholder="ì˜ˆ) OOì¬ë‹¨ ê³ ë¬¸" />
    </section>

    <!-- ì²­íƒê¸ˆì§€ë²• -->
    <section class="section hidden" id="sec-act">
      <h3>ì²­íƒê¸ˆì§€ë²•(ë°°ìš°ì í¬í•¨)</h3>
      <div class="seg" role="group" aria-label="ì²­íƒê¸ˆì§€ë²• ëŒ€ìƒ ì—¬ë¶€">
        <button type="button" class="seg__btn" data-act="ë¹„ëŒ€ìƒ" id="btn-act-no" aria-pressed="false">ë¹„ëŒ€ìƒ</button>
        <button type="button" class="seg__btn" data-act="ëŒ€ìƒ" id="btn-act-yes" aria-pressed="false">ëŒ€ìƒ</button>
      </div>
      <div id="act-extra" class="hidden" style="margin-top:8px">
        <div class="seg" role="group" aria-label="ë³¸ì¸/ë°°ìš°ì ì„ íƒ" style="margin-bottom:8px">
          <button type="button" class="seg__btn" data-who="ë³¸ì¸" id="btn-who-self" aria-pressed="false">ë³¸ì¸</button>
          <button type="button" class="seg__btn" data-who="ë°°ìš°ì" id="btn-who-spouse" aria-pressed="false">ë°°ìš°ì</button>
        </div>
        <div id="spouse-wrap" class="hidden">
          <label>ë°°ìš°ì ì§ì¥ ë° ì§ì±…</label>
          <input type="text" id="spouseCombined" placeholder="ì˜ˆ) OOíšŒì‚¬ ê³¼ì¥" />
        </div>
      </div>
    </section>

    <!-- ì¶•ì˜ê³„ì¢Œ -->
    <section class="section hidden" id="sec-account">
      <h3>ì¶•ì˜ê³„ì¢Œ</h3>
      <div class="row">
        <div class="col" id="bankCol">
          <select id="bankSelect">
            <option value="">ì€í–‰ ì„ íƒ</option>
            <option>êµ­ë¯¼</option><option>ì‹ í•œ</option><option>ìš°ë¦¬</option>
            <option>í•˜ë‚˜</option><option>ë†í˜‘</option><option>ê¸°ì—…</option>
            <option value="__custom__">ì§ì ‘ì…ë ¥</option>
          </select>
          <input class="hidden" id="bankInput" type="text" placeholder="ì€í–‰ëª… ì…ë ¥" />
        </div>
        <div class="col">
          <input type="text" id="account" placeholder="ê³„ì¢Œë²ˆí˜¸(í•˜ì´í”ˆ í¬í•¨)" />
        </div>
      </div>
    </section>

    <!-- ì—°ë½ì²˜ -->
    <section class="section hidden" id="sec-phone">
      <h3>ì—°ë½ì²˜</h3>
      <input type="tel" id="phone" placeholder="010-1234-5678 (í•˜ì´í”ˆ í¬í•¨)" />
    </section>

    <!-- ê³„ì¢Œê³µê°œ -->
    <section class="section hidden" id="sec-open">
      <h3>ê³„ì¢Œê³µê°œ</h3>
      <div class="seg" role="group" aria-label="ê³„ì¢Œê³µê°œ ì„ íƒ">
        <button type="button" class="seg__btn" id="btn-open-yes" data-open="í¬ë§" aria-pressed="false">í¬ë§</button>
        <button type="button" class="seg__btn" id="btn-open-no" data-open="ë¹„í¬ë§" aria-pressed="false">ë¹„í¬ë§</button>
      </div>
      <div class="help">* í‡´ì„ì„ì› ì•ˆë‚´ ë¬¸ì ë‚´ ê³„ì¢Œë²ˆí˜¸ ê³µê°œ</div>
    </section>

    <!-- ë¯¸ë¦¬ë³´ê¸° -->
    <section class="section hidden" id="sec-preview">
      <button class="btn primary full disabled" id="btn-preview" aria-disabled="true">ê²Œì‹œê¸€ ë¯¸ë¦¬ë³´ê¸°</button>
      <div id="err" class="error hidden"></div>
    </section>

    <!-- Footer -->
    <div class="footer">
      <button class="btn primary" id="btn-submit" disabled>ì œì¶œ</button>
      <a class="btn ghost" href="./wedding.html" id="btn-back">ì´ì „</a>
    </div>
  </div>

  <!-- ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ -->
  <dialog id="dlg">
    <div class="dlg-head">ê²Œì‹œê¸€ ë¯¸ë¦¬ë³´ê¸°</div>
    <div class="dlg-body">
      <pre id="previewText" style="white-space:pre-wrap;font-size:14px;line-height:1.4"></pre>
    </div>
    <div class="dlg-foot">
      <button class="btn ghost" id="dlg-cancel">ë‹«ê¸°</button>
      <button class="btn primary" id="dlg-ok">í™•ì¸í•˜ê³  ì œì¶œ</button>
    </div>
  </dialog>

  <script>
    /* ===== ì´ì „ í˜ì´ì§€ ì €ì¥ê°’ ë¡œë“œ (inviteInfo) ===== */
    const KEYMAP = {
      groom: ['groomName','groom','groom_name'],
      bride: ['brideName','bride','bride_name'],
      groomFather: ['groomFather','groom_father','groomFatherName'],
      groomMother: ['groomMother','groom_mother','groomMotherName'],
      brideFather: ['brideFather','bride_father','brideFatherName'],
      brideMother: ['brideMother','bride_mother','brideMotherName']
    };
    const pick = (obj, keys) => { for (const k of keys) if (obj && obj[k]) return String(obj[k]); return ''; };
    function readPrev() {
      let base = {};
      try {
        const s = localStorage.getItem('inviteInfo') || localStorage.getItem('weddingForm');
        if (s) base = JSON.parse(s);
      } catch {}
      const flat = {};
      Object.values(KEYMAP).flat().forEach(k=>{
        const v = localStorage.getItem(k);
        if (v) flat[k] = v;
      });
      const src = { ...base, ...flat };
      return {
        groom:       pick(src, KEYMAP.groom),
        bride:       pick(src, KEYMAP.bride),
        groomFather: pick(src, KEYMAP.groomFather),
        groomMother: pick(src, KEYMAP.groomMother),
        brideFather: pick(src, KEYMAP.brideFather),
        brideMother: pick(src, KEYMAP.brideMother),
      };
    }
    const WF = readPrev();

    /* ===== ìƒíƒœ/ìœ í‹¸ ===== */
    const state = {
      side:'', person:'', status:'',
      dept:'', title:'', curCombined:'',
      act:'', who:'', spouseCombined:'',
      bank:'', account:'', phone:'', open:''
    };
    const el=(id)=>document.getElementById(id);
    const show=(x)=>x.classList.remove('hidden');
    const hide=(x)=>x.classList.add('hidden');
    const enable=(b)=>{b.classList.remove('disabled');b.removeAttribute('aria-disabled');};
    const disable=(b)=>{b.classList.add('disabled');b.setAttribute('aria-disabled','true');};
    const enableSubmit=()=>el('btn-submit').removeAttribute('disabled');
    const disableSubmit=()=>el('btn-submit').setAttribute('disabled','');
    const press=(btn,on)=>{btn.setAttribute('aria-pressed',String(!!on)); if(on){btn.classList.add('is-selected');}else{btn.classList.remove('is-selected');}};

    const secPerson=el('sec-person'),secStatus=el('sec-status'),secOnjob=el('sec-onjob'),
          secRetire=el('sec-retire'),secAct=el('sec-act'),secAccount=el('sec-account'),
          secPhone=el('sec-phone'),secOpen=el('sec-open'),secPreview=el('sec-preview'),err=el('err');

    function roleLabel(role, name) { return name ? `${role} Â· ${name}` : `${role} Â· ì„±í•¨ ì—†ìŒ`; }

    /* ====== ğŸ”¹ AI ì œì•ˆ ë¡œë“œ & ìë™ í”„ë¦¬í•„ ìœ í‹¸ ====== */
    let AI = {};
    try {
      AI = JSON.parse(localStorage.getItem('ai_suggestions') || '{}');
    } catch { AI = {}; }

    // ì¸¡/ì¸ë¬¼ ì¡°í•© â†’ (bank, account, phone) ì œì•ˆê°’ ì„ íƒ
    function pickSuggestion(side, person) {
      const map = {
        groom: {
          father: { bank: AI.groomFatherBank, account: AI.groomFatherAccount, phone: AI.groomFatherPhone },
          mother: { bank: AI.groomMotherBank, account: AI.groomMotherAccount, phone: AI.groomMotherPhone },
          self:   { bank: AI.groomBank,       account: AI.groomAccount,       phone: AI.groomPhone }
        },
        bride: {
          father: { bank: AI.brideFatherBank, account: AI.brideFatherAccount, phone: AI.brideFatherPhone },
          mother: { bank: AI.brideMotherBank, account: AI.brideMotherAccount, phone: AI.brideMotherPhone },
          self:   { bank: AI.brideBank,       account: AI.brideAccount,       phone: AI.bridePhone }
        }
      };
      const o = (map[side] && map[side][person]) || {};
      return {
        bank: (o.bank || '').trim(),
        account: (o.account || '').trim(),
        phone: (o.phone || '').trim()
      };
    }

    // ì…ë ¥ì¹¸ì— ì œì•ˆê°’ ë°˜ì˜ (ë¹ˆ ì¹¸ì¼ ë•Œë§Œ)
    function applySuggestionToInputs(sug) {
      const bankSelect = el('bankSelect');
      const bankInput  = el('bankInput');
      const accountEl  = el('account');
      const phoneEl    = el('phone');

      // ì€í–‰
      if (sug.bank) {
        const hasOpt = [...bankSelect.options].some(o => (o.textContent === sug.bank || o.value === sug.bank));
        if (hasOpt) {
          bankSelect.value = sug.bank;
          bankInput.classList.add('hidden');
          bankSelect.classList.remove('hidden');
          state.bank = bankSelect.value;
        } else {
          bankSelect.value = "__custom__";
          bankSelect.classList.add('hidden');
          bankInput.classList.remove('hidden');
          if (!bankInput.value) bankInput.value = sug.bank;
          state.bank = bankInput.value.trim();
        }
      }

      // ê³„ì¢Œ
      if (sug.account && !accountEl.value) {
        accountEl.value = sug.account;
        state.account = sug.account;
      }

      // ì „í™”
      if (sug.phone && !phoneEl.value) {
        phoneEl.value = sug.phone;
        state.phone = sug.phone;
      }

      validate();
    }

    /* ===== ì¸¡ ì„ íƒ ===== */
    function selectSide(side){
      state.side=side;
      press(el('btn-groom-side'), side==='groom');
      press(el('btn-bride-side'), side==='bride');
      if(side==='groom'){
        el('btn-father').textContent=roleLabel('ì•„ë²„ì§€',WF.groomFather);
        el('btn-mother').textContent=roleLabel('ì–´ë¨¸ë‹ˆ',WF.groomMother);
        el('btn-self').textContent=roleLabel('ë³¸ì¸',WF.groom);
      }else{
        el('btn-father').textContent=roleLabel('ì•„ë²„ì§€',WF.brideFather);
        el('btn-mother').textContent=roleLabel('ì–´ë¨¸ë‹ˆ',WF.brideMother);
        el('btn-self').textContent=roleLabel('ë³¸ì¸',WF.bride);
      }
      show(secPerson);

      // ğŸ”½ sideë§Œ ì„ íƒí•´ë„ 'ë³¸ì¸' ê¸°ì¤€ìœ¼ë¡œ ìš°ì„  í”„ë¦¬í•„
      const sug = pickSuggestion(state.side, 'self');
      applySuggestionToInputs(sug);
    }
    el('btn-groom-side').addEventListener('click',()=>selectSide('groom'));
    el('btn-bride-side').addEventListener('click',()=>selectSide('bride'));

    /* ===== ì„±í•¨ ì„ íƒ ===== */
    function selectPerson(p){
      state.person=p;
      press(el('btn-father'),p==='father');
      press(el('btn-mother'),p==='mother');
      press(el('btn-self'),  p==='self');
      show(secStatus);

      // ğŸ”½ ì¸¡+ì¸ë¬¼ ì¡°í•©ì— ë§ì¶° ìë™ í”„ë¦¬í•„
      const sug = pickSuggestion(state.side, state.person);
      applySuggestionToInputs(sug);
    }
    el('btn-father').addEventListener('click',()=>selectPerson('father'));
    el('btn-mother').addEventListener('click',()=>selectPerson('mother'));
    el('btn-self').addEventListener('click',()=>selectPerson('self'));

    /* ===== ì¬ì§/í‡´ì„ ===== */
    function selectStatus(s){
      state.status=s;
      press(el('btn-onjob'), s==='ì¬ì§');
      press(el('btn-retire'),s==='í‡´ì„');

      if(s==='í‡´ì„'){
        el('lbl-dept').innerHTML='ê·¼ë¬´ ë¶€ì„œ <span class="muted">(ì¬ì§ì‹œ)</span>';
        el('lbl-title').innerHTML='ì§ì±… <span class="muted">(ì¬ì§ì‹œ)</span>';
        show(secOnjob);
        show(secRetire);
      }else{
        el('lbl-dept').innerHTML='ê·¼ë¬´ ë¶€ì„œ<span class="req">*</span>';
        el('lbl-title').innerHTML='ì§ì±…<span class="req">*</span>';
        show(secOnjob);
        hide(secRetire);
      }

      show(secAct); show(secAccount); show(secPhone); show(secOpen); show(secPreview);
      validate();
    }
    el('btn-onjob').addEventListener('click',()=>selectStatus('ì¬ì§'));
    el('btn-retire').addEventListener('click',()=>selectStatus('í‡´ì„'));

    /* ===== ì€í–‰ ì„ íƒ/ì§ì ‘ì…ë ¥ ===== */
    const bankSelect=el('bankSelect'), bankInput=el('bankInput');
    function syncBankState(){
      if(bankSelect && bankSelect.value==='__custom__'){
        bankSelect.classList.add('hidden');
        bankInput.classList.remove('hidden');
        bankInput.focus();
        state.bank = bankInput.value.trim();
      }else if(bankSelect){
        bankInput.classList.add('hidden');
        bankSelect.classList.remove('hidden');
        state.bank = bankSelect.value.trim();
      }
      validate();
    }
    bankSelect.addEventListener('change', syncBankState);
    bankInput.addEventListener('input', ()=>{ state.bank=bankInput.value.trim(); validate(); });

    /* ===== ì…ë ¥ ë°”ì¸ë”© ===== */
    ['dept','title','curCombined','spouseCombined'].forEach(id=>el(id)?.addEventListener('input',e=>{
      state[id]=e.target.value.trim();
      validate();
    }));
    el('account').addEventListener('input',e=>{ state.account=e.target.value; validate(); });
    el('phone').addEventListener('input',e=>{ state.phone=e.target.value; validate(); });

    /* ===== ì²­íƒê¸ˆì§€ë²• ===== */
    function selectAct(v){
      state.act=v;
      press(el('btn-act-no'), v==='ë¹„ëŒ€ìƒ');
      press(el('btn-act-yes'), v==='ëŒ€ìƒ');
      if(v==='ëŒ€ìƒ'){
        show(el('act-extra'));
      } else {
        hide(el('act-extra'));
        state.who='';
        press(el('btn-who-self'), false);
        press(el('btn-who-spouse'), false);
        hide(el('spouse-wrap'));
        state.spouseCombined='';
      }
      validate();
    }
    el('btn-act-no').addEventListener('click',()=>selectAct('ë¹„ëŒ€ìƒ'));
    el('btn-act-yes').addEventListener('click',()=>selectAct('ëŒ€ìƒ'));

    function selectWho(v){
      state.who=v;
      press(el('btn-who-self'), v==='ë³¸ì¸');
      press(el('btn-who-spouse'), v==='ë°°ìš°ì');
      if(v==='ë°°ìš°ì'){ show(el('spouse-wrap')); } else { hide(el('spouse-wrap')); state.spouseCombined=''; }
      validate();
    }
    el('btn-who-self').addEventListener('click',()=>selectWho('ë³¸ì¸'));
    el('btn-who-spouse').addEventListener('click',()=>selectWho('ë°°ìš°ì'));

    /* ===== ê³„ì¢Œê³µê°œ ===== */
    function selectOpen(v){ state.open=v; press(el('btn-open-yes'),v==='í¬ë§'); press(el('btn-open-no'),v==='ë¹„í¬ë§'); validate(); }
    el('btn-open-yes').addEventListener('click',()=>selectOpen('í¬ë§'));
    el('btn-open-no').addEventListener('click',()=>selectOpen('ë¹„í¬ë§'));

    /* ===== ê²€ì¦ ===== */
    function validate(){
      err.classList.add('hidden'); err.textContent='';

      if(!state.side||!state.person||!state.status){ disable(el('btn-preview')); disableSubmit(); return; }

      if(state.status==='ì¬ì§'){
        if(!state.dept||!state.title){ disable(el('btn-preview')); disableSubmit(); return; }
      }else{ // í‡´ì„
        if(!state.dept||!state.title||!state.curCombined){ disable(el('btn-preview')); disableSubmit(); return; }
      }

      if(state.act==='ëŒ€ìƒ' && !state.who){ disable(el('btn-preview')); disableSubmit(); return; }
      if(state.who==='ë°°ìš°ì' && !state.spouseCombined.trim()){ disable(el('btn-preview')); disableSubmit(); return; }

      if(!state.bank){ disable(el('btn-preview')); disableSubmit(); return; }
      if(!/^[0-9-]{6,}$/.test(state.account)){ disable(el('btn-preview')); disableSubmit(); return; }
      if(!/^[0-9-]{10,13}$/.test(state.phone)){ disable(el('btn-preview')); disableSubmit(); return; }

      if(!state.open){ disable(el('btn-preview')); disableSubmit(); return; }

      enable(el('btn-preview')); enableSubmit();
    }

    /* ===== ë¯¸ë¦¬ë³´ê¸°/ì œì¶œ ===== */
    function buildPreview(){
      const sideKo=state.side==='groom'?'ì‹ ë‘ì¸¡':'ì‹ ë¶€ì¸¡';
      const nameSet=state.side==='groom'
        ? {father:WF.groomFather,mother:WF.groomMother,self:WF.groom}
        : {father:WF.brideFather,mother:WF.brideMother,self:WF.bride};
      const whoName=state.person==='father'?'ì•„ë²„ì§€':(state.person==='mother'?'ì–´ë¨¸ë‹ˆ':'ë³¸ì¸');
      const subjectName=nameSet[state.person]||'(ì„±í•¨ ë¯¸ì…ë ¥)';
      const lines=[];
      lines.push(`[${sideKo}] ${whoName}: ${subjectName}`);
      lines.push(`ì‚¼ì„±ì „ì ì¬ì§ì—¬ë¶€: ${state.status}`);
      lines.push(`ë¶€ì„œ/ì§ì±…(ì¬ì§ì‹œ): ${state.dept||'-'} / ${state.title||'-'}`);
      if(state.status==='í‡´ì„'){lines.push(`í˜„ì§ì¥/ì§ì±…: ${state.curCombined||'-'}`);}
      lines.push(`ì²­íƒê¸ˆì§€ë²•: ${state.act||'ë¯¸ì„ íƒ'}`);
      if(state.act==='ëŒ€ìƒ'){lines.push(`ëŒ€ìƒ êµ¬ë¶„: ${state.who}`);}
      if(state.who==='ë°°ìš°ì'){lines.push(`ë°°ìš°ì ì§ì¥/ì§ì±…: ${state.spouseCombined||'-'}`);}
      lines.push(`ì¶•ì˜ê³„ì¢Œ: ${state.bank} ${state.account}`);
      lines.push(`ì—°ë½ì²˜(ë³¸ì¸): ${state.phone}`);
      lines.push(`ê³„ì¢Œê³µê°œ: ${state.open}`);
      return lines.join('\n');
    }

    el('btn-preview').addEventListener('click',()=>{
      if(el('btn-preview').hasAttribute('aria-disabled')) return;
      el('previewText').textContent=buildPreview();
      el('dlg').showModal();
    });
    el('dlg-cancel').addEventListener('click',()=>el('dlg').close());
    el('dlg-ok').addEventListener('click',()=>{ el('dlg').close(); submit(); });

    function submit(){
      localStorage.setItem('weddingDetail', JSON.stringify(state));
      alert('ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. (ì„ì‹œ ì €ì¥: localStorage.weddingDetail)');
    }
    document.getElementById('btn-submit').addEventListener('click',()=>{
      if(!el('btn-submit').hasAttribute('disabled')) submit();
    });

    // ì´ˆê¸° ê²€ì¦
    validate();
  </script>
</body>
</html>
