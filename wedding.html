<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì¶”ê°€ ì •ë³´ ì…ë ¥</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px;color:#111}
.card{max-width:720px;margin:0 auto;padding:20px;border:1px solid #ddd;border-radius:12px}
h2{margin-top:0}
label{display:block;margin:12px 0 4px;font-weight:600}
input,select,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
textarea{min-height:60px}
.row{display:flex;gap:8px}
.btn{padding:12px 16px;border:0;border-radius:8px;cursor:pointer}
.btn.primary{background:#111;color:#fff}
.preview{white-space:pre-wrap;border:1px solid #ccc;padding:12px;border-radius:8px;background:#f9f9f9;margin-top:12px}
.success{color:green}
.error{color:red}
.hint{font-size:12px;color:#666}
.hidden{display:none}
</style>
</head>
<body>
<div class="card">
  <h2>ì¶”ê°€ ì •ë³´ ì…ë ¥</h2>

  <form id="form">
    <!-- ì„ì› ì„±í•¨ -->
    <label>ì„ì› ì„±í•¨ *</label>
    <input name="name" required />

    <!-- ì¬ì§/í‡´ì§ -->
    <label>ì¬ì§/í‡´ì§ *</label>
    <select name="empStatus" required>
      <option value="">ì„ íƒ</option>
      <option>ì¬ì§</option>
      <option>í‡´ì§</option>
    </select>

    <!-- ê·¼ë¬´ ë¶€ì„œ -->
    <label>ê·¼ë¬´ ë¶€ì„œ *</label>
    <input name="deptWhenEmployed" required />

    <!-- ì§ì±… -->
    <label>ì§ì±… *</label>
    <input name="currentJobTitle" required />

    <!-- í˜„ ì§ì¥/ì§ì±… -->
    <label>í˜„ ì§ì¥/ì§ì±… *</label>
    <input name="jobNow" required />

    <!-- ì²­íƒê¸ˆì§€ë²• -->
    <label>ì²­íƒê¸ˆì§€ë²• ì ìš© ì—¬ë¶€ *</label>
    <select name="antiGraft" id="antiGraft" required>
      <option value="">ì„ íƒ</option>
      <option value="ëŒ€ìƒ">ëŒ€ìƒ</option>
      <option value="ë¹„ëŒ€ìƒ">ë¹„ëŒ€ìƒ</option>
    </select>

    <!-- ì²­íƒê¸ˆì§€ë²• â†’ ë³¸ì¸/ë°°ìš°ì í™•ì¸ -->
    <div id="antiGraftExtra" class="hidden">
      <label>ëŒ€ìƒì í™•ì¸ *</label>
      <select name="antiGraftTarget" id="antiGraftTarget">
        <option value="">ì„ íƒ</option>
        <option>ë³¸ì¸</option>
        <option>ë°°ìš°ì</option>
      </select>
    </div>

    <!-- ë°°ìš°ì ì§ì¥/ì§ì±… -->
    <div id="spouseJobWrap" class="hidden">
      <label>ë°°ìš°ì í˜„ ì§ì¥/ì§ì±… *</label>
      <input name="spouseJob" />
    </div>

    <!-- ì¶•ì˜ê³„ì¢Œ -->
    <label>ì¶•ì˜ê³„ì¢Œ *</label>
    <input name="bankNumber" required placeholder="000-0000-0000-00" />

    <label>ì€í–‰ *</label>
    <select name="bankName" required>
      <option value="">ì„ íƒ</option>
      <option>êµ­ë¯¼</option><option>ì‹ í•œ</option><option>ìš°ë¦¬</option>
      <option>í•˜ë‚˜</option><option>ë†í˜‘</option><option>ê¸°ì—…</option>
      <option>ê¸°íƒ€</option>
    </select>

    <!-- ì—°ë½ì²˜ -->
    <label>ì—°ë½ì²˜ *</label>
    <input name="phone" required placeholder="010-1234-5678" />

    <!-- ê³„ì¢Œ ê³µê°œ ì—¬ë¶€ -->
    <label>í‡´ì„ì„ì› ë¬¸ìì•Œë¦¼ ê³„ì¢Œë²ˆí˜¸ ê³µê°œ ì—¬ë¶€ *</label>
    <select name="accountDisclosure" required>
      <option value="">ì„ íƒ</option>
      <option>í¬ë§</option>
      <option>ë¹„í¬ë§</option>
    </select>

    <button type="submit" class="btn primary">ì œì¶œ</button>
  </form>

  <h3>ê²Œì‹œíŒ ì•ˆë‚´ë¬¸ ë¯¸ë¦¬ë³´ê¸°</h3>
  <div id="previewBox" class="preview hidden"></div>
  <p id="msg"></p>
</div>

<script>
// ğŸš© Apps Script URL
const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

// ===== invite.html â†’ wedding.html ë°ì´í„° ì´ê´€ =====
const inviteExtract=JSON.parse(localStorage.getItem('inviteExtract')||'{}');

// ===== ì²­íƒê¸ˆì§€ë²• ëŒ€ìƒ ì¶”ê°€ ì…ë ¥ í‘œì‹œ =====
const antiSel=document.getElementById('antiGraft');
const extra=document.getElementById('antiGraftExtra');
const spouseJob=document.getElementById('spouseJobWrap');
antiSel.addEventListener('change',()=>{
  const v=antiSel.value;
  extra.classList.toggle('hidden',v!=='ëŒ€ìƒ');
  spouseJob.classList.add('hidden');
});
document.getElementById('antiGraftTarget').addEventListener('change',e=>{
  spouseJob.classList.toggle('hidden',e.target.value!=='ë°°ìš°ì');
});

// ===== ì œì¶œ =====
document.getElementById('form').addEventListener('submit',async e=>{
  e.preventDefault();
  const f=new FormData(e.target);
  let payload=Object.fromEntries(f.entries());

  // inviteExtractì™€ merge
  payload={...inviteExtract,...payload,eventType:"ê²½ì‚¬"};

  const msg=document.getElementById('msg');
  msg.textContent="ì „ì†¡ ì¤‘..."; msg.className="";

  try{
    const res=await fetch(ENDPOINT,{method:"POST",body:JSON.stringify(payload)});
    const text=await res.text();
    const data=JSON.parse(text);

    if(data.ok){
      msg.textContent="ì œì¶œ ì™„ë£Œ!"; msg.className="success";
      const box=document.getElementById('previewBox');
      box.textContent=data.preview||"ë¯¸ë¦¬ë³´ê¸°ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
      box.classList.remove('hidden');
    }else{
      msg.textContent="ì˜¤ë¥˜: "+(data.error||"ì œì¶œ ì‹¤íŒ¨"); msg.className="error";
    }
  }catch(err){
    msg.textContent="ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: "+err.message; msg.className="error";
  }
});
</script>
</body>
</html>
