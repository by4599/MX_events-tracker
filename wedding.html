<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ê²°í˜¼ì‹ ì •ë³´ ì…ë ¥</title>
<style>
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  margin:0;padding:16px;background:#f9f9f9;color:#111
}
.card{
  max-width:420px;
  margin:0 auto;background:#fff;padding:16px;
  border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1)
}
h2{margin-top:0;font-size:18px}
h3{margin:12px 0;font-size:16px}
.row-inline{
  display:flex;align-items:center;gap:6px;margin:8px 0;
  flex-wrap:wrap;
}
.row-inline label{
  flex:0 0 100px;font-size:14px;font-weight:600
}
.row-inline input,.row-inline select{
  flex:1;min-width:0;
  padding:8px;font-size:14px;
  border:1px solid #ccc;border-radius:6px
}
.btn{
  padding:10px 12px;border:0;border-radius:6px;
  cursor:pointer;font-weight:600;font-size:14px
}
.btn.primary{background:#111;color:#fff;width:100%;margin-top:16px}
.btn.blue{background:#007bff;color:#fff}
.btn-inline{
  flex:0 0 auto;margin-left:auto;margin-top:6px;width:100%
}
@media(min-width:600px){
  .btn-inline{width:auto;margin-top:0}
}
.checkbox{margin:12px 0;display:flex;align-items:center;gap:6px;}
.section{margin-top:16px;padding-top:12px;border-top:1px solid #eee}
.note{font-size:12px;color:#666;margin-top:2px}
</style>
</head>
<body>
<div class="card">
  <h2>ê²°í˜¼ì‹ ê¸°ë³¸ ì •ë³´ ì…ë ¥</h2>

  <!-- ì²­ì²©ì¥ URL -->
  <div class="row-inline">
    <label for="inviteUrl">ì²­ì²©ì¥ URL *</label>
    <input id="inviteUrl" placeholder="https://..." />
  </div>
  <div class="checkbox">
    <input type="checkbox" id="noInvite">
    <label for="noInvite" style="margin:0">ëª¨ë°”ì¼ ì²­ì²©ì¥ ì—†ìŒ</label>
  </div>
  <button class="btn blue" id="btnCheckUrl" style="width:100%">AIë¡œ ì˜ˆì‹ì •ë³´ í™•ì¸</button>
  <div id="urlResult" style="margin-top:6px;font-size:13px;color:#333"></div>

  <!-- ì‹ ë‘ì¸¡ -->
  <div class="section">
    <h3>ì‹ ë‘ì¸¡</h3>
    <div class="row-inline"><label>í˜¼ì£¼ ì•„ë²„ì§€ *</label><input id="groomFather" /></div>
    <div class="row-inline"><label>í˜¼ì£¼ ì–´ë¨¸ë‹ˆ *</label><input id="groomMother" /></div>
    <div class="row-inline">
      <label>í˜•ì œê´€ê³„ *</label>
      <select id="groomOrder">
        <option value="">ì„ íƒ</option>
        <option>ì¥ë‚¨</option><option>ì°¨ë‚¨</option><option>ì‚¼ë‚¨</option>
      </select>
    </div>
    <div class="row-inline"><label>ì‹ ë‘ ì„±ëª… *</label><input id="groomName" /></div>
  </div>

  <!-- ì‹ ë¶€ì¸¡ -->
  <div class="section">
    <h3>ì‹ ë¶€ì¸¡</h3>
    <div class="row-inline"><label>í˜¼ì£¼ ì•„ë²„ì§€ *</label><input id="brideFather" /></div>
    <div class="row-inline"><label>í˜¼ì£¼ ì–´ë¨¸ë‹ˆ *</label><input id="brideMother" /></div>
    <div class="row-inline">
      <label>í˜•ì œê´€ê³„ *</label>
      <select id="brideOrder">
        <option value="">ì„ íƒ</option>
        <option>ì¥ë…€</option><option>ì°¨ë…€</option><option>ì‚¼ë…€</option>
      </select>
    </div>
    <div class="row-inline"><label>ì‹ ë¶€ ì„±ëª… *</label><input id="brideName" /></div>
  </div>

  <!-- ì˜ˆì‹ ì •ë³´ -->
  <div class="section">
    <h3>ì˜ˆì‹ ì •ë³´</h3>
    <div class="row-inline"><label>ì˜ˆì‹ì¼ *</label><input type="date" id="eventDate" /></div>
    <div class="row-inline"><label>ì˜ˆì‹ì‹œê°„ *</label><input type="time" id="eventTime" step="600" /></div>
    <div class="note">â€» í•´ì™¸ì˜ ê²½ìš° í˜„ì§€ì‹œê°„ìœ¼ë¡œ ì…ë ¥ ë°”ëë‹ˆë‹¤.</div>

    <div class="row-inline">
      <label>ì˜ˆì‹ì¥ ì£¼ì†Œ *</label>
      <input id="venueAddr" placeholder="ë„ë¡œëª… ì£¼ì†Œ ì…ë ¥" readonly />
      <button type="button" class="btn blue btn-inline" onclick="searchAddress()">ê²€ìƒ‰</button>
    </div>
    <div class="row-inline"><label>ì˜ˆì‹ì¥ ì„¸ë¶€ *</label><input id="venueDetail" placeholder="ì¸µ/í™€ëª… ë“±" /></div>

    <div class="row-inline">
      <label>ìŠ¤ëª°ì›¨ë”© *</label>
      <select id="isSmallWedding">
        <option value="">ì„ íƒ</option><option>ì˜ˆ</option><option>ì•„ë‹ˆì˜¤</option>
      </select>
    </div>
    <div class="row-inline">
      <label>í™”í™˜ ìˆ˜ë ¹ *</label>
      <select id="flowerOption">
        <option value="">ì„ íƒ</option><option>í¬ë§</option><option>ë¹„í¬ë§</option>
      </select>
    </div>
  </div>

  <button class="btn primary" id="btnNext">ì¶”ê°€ ì •ë³´ ì…ë ¥</button>
</div>

<!-- ğŸŸ¢ Daum ì£¼ì†Œê²€ìƒ‰ API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<script>
// Apps Script Endpoint
const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

// ğŸŸ¢ ì „í™”ë²ˆí˜¸ í•˜ì´í”ˆ í¬ë§·
function formatVenueAddr(rawAddr){
  const telMatch = rawAddr.match(/(\d{2,4}[- ]?\d{3,4}[- ]?\d{4})/);
  if(telMatch){
    let tel = telMatch[1].replace(/\D/g,"");
    if(tel.length===10){
      tel = tel.replace(/(\d{2})(\d{3,4})(\d{4})/,"$1-$2-$3");
    }else if(tel.length===11){
      tel = tel.replace(/(\d{3})(\d{4})(\d{4})/,"$1-$2-$3");
    }
    return rawAddr.replace(telMatch[1], tel);
  }
  return rawAddr;
}

// ğŸŸ¢ AIë¡œ ì˜ˆì‹ì •ë³´ í™•ì¸
document.getElementById('btnCheckUrl').addEventListener('click', async ()=>{
  const url=document.getElementById('inviteUrl').value;
  if(!url){ alert("URLì„ ì…ë ¥í•˜ì„¸ìš”."); return; }

  document.getElementById('urlResult').innerHTML="<span style='color:blue'>AIë¡œ ë¶„ì„ ì¤‘ì´ë‹ˆ ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</span>";

  try{
    const res=await fetch(`${ENDPOINT}?action=extract&url=${encodeURIComponent(url)}`);
    const data=await res.json();
    if(data.ok){
      document.getElementById('groomFather').value=data.groomFather||"";
      document.getElementById('groomMother').value=data.groomMother||"";
      document.getElementById('groomOrder').value=data.groomOrder||"";
      document.getElementById('groomName').value=data.groomName||"";
      document.getElementById('brideFather').value=data.brideFather||"";
      document.getElementById('brideMother').value=data.brideMother||"";
      document.getElementById('brideOrder').value=data.brideOrder||"";
      document.getElementById('brideName').value=data.brideName||"";
      document.getElementById('eventDate').value=data.eventDate||"";
      document.getElementById('eventTime').value=data.eventTime||"";
      document.getElementById('venueAddr').value=formatVenueAddr(data.venueAddr||"");
      document.getElementById('venueDetail').value=data.venue||"";

      document.getElementById('urlResult').innerHTML="<span style='color:green'>AIë¡œ ì˜ˆì‹ ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸ ë°”ëë‹ˆë‹¤ âœ…</span>";
    }else{
      document.getElementById('urlResult').innerHTML="<span style='color:red'>ì •ë³´ ì¶”ì¶œ ì‹¤íŒ¨ âŒ</span>";
    }
  }catch(err){
    document.getElementById('urlResult').innerHTML="<span style='color:red'>ì˜¤ë¥˜: "+err.message+"</span>";
  }
});

// ğŸŸ¢ ë‹¤ìŒ ë‹¨ê³„ ì €ì¥ (í•„ìˆ˜ ê²€ì¦ ì¶”ê°€)
document.getElementById('btnNext').addEventListener('click',()=>{
  const requiredFields = [
    {id:'inviteUrl', label:'ì²­ì²©ì¥ URL', skipIfNoInvite:true},
    {id:'groomFather', label:'ì‹ ë‘ í˜¼ì£¼ ì•„ë²„ì§€'},
    {id:'groomMother', label:'ì‹ ë‘ í˜¼ì£¼ ì–´ë¨¸ë‹ˆ'},
    {id:'groomOrder', label:'ì‹ ë‘ í˜•ì œê´€ê³„'},
    {id:'groomName', label:'ì‹ ë‘ ì„±ëª…'},
    {id:'brideFather', label:'ì‹ ë¶€ í˜¼ì£¼ ì•„ë²„ì§€'},
    {id:'brideMother', label:'ì‹ ë¶€ í˜¼ì£¼ ì–´ë¨¸ë‹ˆ'},
    {id:'brideOrder', label:'ì‹ ë¶€ í˜•ì œê´€ê³„'},
    {id:'brideName', label:'ì‹ ë¶€ ì„±ëª…'},
    {id:'eventDate', label:'ì˜ˆì‹ì¼'},
    {id:'eventTime', label:'ì˜ˆì‹ì‹œê°„'},
    {id:'venueAddr', label:'ì˜ˆì‹ì¥ ì£¼ì†Œ'},
    {id:'venueDetail', label:'ì˜ˆì‹ì¥ ì„¸ë¶€'},
    {id:'isSmallWedding', label:'ìŠ¤ëª°ì›¨ë”© ì—¬ë¶€'},
    {id:'flowerOption', label:'í™”í™˜ ìˆ˜ë ¹'}
  ];

  for(const f of requiredFields){
    const val=document.getElementById(f.id).value.trim();
    if(f.skipIfNoInvite && document.getElementById('noInvite').checked){
      continue; // ì²­ì²©ì¥ ì—†ìŒ ì²´í¬ ì‹œ URL ë¬´ì‹œ
    }
    if(!val){
      alert(`${f.label} í•­ëª©ì„ ì…ë ¥/ì„ íƒí•´ ì£¼ì„¸ìš”.`);
      document.getElementById(f.id).focus();
      return;
    }
  }

  // âœ… ì €ì¥
  const info={
    inviteUrl:document.getElementById('inviteUrl').value,
    noInvite:document.getElementById('noInvite').checked,
    groomFather:document.getElementById('groomFather').value,
    groomMother:document.getElementById('groomMother').value,
    groomOrder:document.getElementById('groomOrder').value,
    groomName:document.getElementById('groomName').value,
    brideFather:document.getElementById('brideFather').value,
    brideMother:document.getElementById('brideMother').value,
    brideOrder:document.getElementById('brideOrder').value,
    brideName:document.getElementById('brideName').value,
    eventDate:document.getElementById('eventDate').value,
    eventTime:document.getElementById('eventTime').value,
    venueAddr:document.getElementById('venueAddr').value,
    venueDetail:document.getElementById('venueDetail').value,
    isSmallWedding:document.getElementById('isSmallWedding').value,
    flowerOption:document.getElementById('flowerOption').value
  };
  localStorage.setItem('inviteInfo',JSON.stringify(info));
  location.href='wedding_detail.html';
});

// ğŸŸ¢ ë„ë¡œëª… ì£¼ì†Œ ê²€ìƒ‰
function searchAddress(){
  new daum.Postcode({
    oncomplete: function(data) {
      document.getElementById("venueAddr").value = data.roadAddress || data.address;
    }
  }).open();
}
</script>
</body>
</html>
