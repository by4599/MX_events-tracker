<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì²­ì²©ì¥ AI ë¶„ì„</title>
  <style>
    body {
      font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      margin:0;
      padding:16px;
      background:#f9f9f9;
      color:#111;
    }
    .card {
      max-width:420px;
      margin:0 auto;
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
    }
    h1 { font-size:20px; margin:0 0 12px 0; }
    label { font-size:14px; color:#555; }
    input[type=text] {
      width:100%;
      padding:10px;
      border:1px solid #ccc;
      border-radius:8px;
      font-size:15px;
      box-sizing:border-box;
    }
    button {
      width:100%;
      padding:12px;
      margin-top:14px;
      background:#0055ff;
      color:#fff;
      border:none;
      border-radius:8px;
      font-size:16px;
      cursor:pointer;
    }
    button:disabled {
      background:#ccc;
      cursor:not-allowed;
    }
    .msg {
      margin-top:12px;
      font-size:14px;
      color:#333;
      white-space:pre-wrap;
      word-break:break-all;
    }
    .footer {
      margin-top:30px;
      font-size:12px;
      color:#777;
      text-align:center;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ’Œ ëª¨ë°”ì¼ ì²­ì²©ì¥ AI ë¶„ì„</h1>
    <label>ì²­ì²©ì¥ URL</label>
    <input type="text" id="urlInput" placeholder="https://..." />
    <button id="btnCheck">AIë¡œ ì˜ˆì‹ ì •ë³´ í™•ì¸</button>
    <div id="msg" class="msg"></div>
    <button id="btnNext" style="display:none;background:#009966;">ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™</button>
  </div>
  <div class="footer">
    Powered by Google Apps Script + Gemini API
  </div>

  <script>
    const btnCheck = document.getElementById("btnCheck");
    const btnNext = document.getElementById("btnNext");
    const msg = document.getElementById("msg");
    const input = document.getElementById("urlInput");

    btnCheck.onclick = async () => {
      const url = input.value.trim();
      if (!url) {
        msg.textContent = "âŒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      msg.textContent = "â³ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...";
      btnCheck.disabled = true;
      btnNext.style.display = "none";

      try {
        // âš ï¸ ë°°í¬í•œ Apps Script ì›¹ì•± URLë¡œ êµì²´í•˜ì„¸ìš”.
        const endpoint = "https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxxx/exec";
        const apiUrl = `${endpoint}?action=extract&url=${encodeURIComponent(url)}`;
        const res = await fetch(apiUrl);
        const data = await res.json();

        if (!data.ok) {
          msg.textContent = "âŒ ë¶„ì„ ì‹¤íŒ¨: " + (data.error || "ì›ì¸ ë¶ˆëª…");
          btnCheck.disabled = false;
          return;
        }

        const payload = data.data || {};
        msg.textContent =
          "âœ… ë¶„ì„ ì™„ë£Œ\n\n" +
          Object.entries(payload)
            .filter(([k,v]) => v)
            .map(([k,v]) => `${k}: ${v}`)
            .join("\n");

        // âœ… ì¶”ê°€: Wedding_detail.htmlì—ì„œ ìë™ í”„ë¦¬í•„ìš©ìœ¼ë¡œ ê²°ê³¼ ì €ì¥
        const aiSuggestions = {
          groomFatherPhone: payload.groomFatherPhone || "",
          groomMotherPhone: payload.groomMotherPhone || "",
          brideFatherPhone: payload.brideFatherPhone || "",
          brideMotherPhone: payload.brideMotherPhone || "",
          groomPhone:       payload.groomPhone       || "",
          bridePhone:       payload.bridePhone       || "",
          venueTel:         payload.venueTel         || "",

          groomFatherBank:    payload.groomFatherBank    || "",
          groomFatherAccount: payload.groomFatherAccount || "",
          groomMotherBank:    payload.groomMotherBank    || "",
          groomMotherAccount: payload.groomMotherAccount || "",
          brideFatherBank:    payload.brideFatherBank    || "",
          brideFatherAccount: payload.brideFatherAccount || "",
          brideMotherBank:    payload.brideMotherBank    || "",
          brideMotherAccount: payload.brideMotherAccount || "",
          groomBank:          payload.groomBank          || "",
          groomAccount:       payload.groomAccount       || "",
          brideBank:          payload.brideBank          || "",
          brideAccount:       payload.brideAccount       || ""
        };
        localStorage.setItem("ai_suggestions", JSON.stringify(aiSuggestions));
        console.log("âœ… ì €ì¥ëœ ai_suggestions:", aiSuggestions);

        btnCheck.disabled = false;
        btnNext.style.display = "block";
      } catch (err) {
        console.error(err);
        msg.textContent = "âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” API ì‘ë‹µ ì‹¤íŒ¨: " + err.message;
        btnCheck.disabled = false;
      }
    };

    btnNext.onclick = () => {
      location.href = "wedding_detail.html";
    };
  </script>
</body>
</html>
