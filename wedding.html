<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>추가 정보 입력</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px;color:#111}
.card{max-width:720px;margin:0 auto;padding:20px;border:1px solid #ddd;border-radius:12px}
h2{margin-top:0}
label{display:block;margin:12px 0 4px;font-weight:600}
input,select,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
textarea{min-height:60px}
.row{display:flex;gap:8px}
.btn{padding:12px 16px;border:0;border-radius:8px;cursor:pointer}
.btn.primary{background:#111;color:#fff}
.preview{white-space:pre-wrap;border:1px solid #ccc;padding:12px;border-radius:8px;background:#f9f9f9;margin-top:12px}
.success{color:green}
.error{color:red}
.hint{font-size:12px;color:#666}
.hidden{display:none}
</style>
</head>
<body>
<div class="card">
  <h2>추가 정보 입력</h2>

  <form id="form">
    <!-- 임원 성함 -->
    <label>임원 성함 *</label>
    <input name="name" required />

    <!-- 재직/퇴직 -->
    <label>재직/퇴직 *</label>
    <select name="empStatus" required>
      <option value="">선택</option>
      <option>재직</option>
      <option>퇴직</option>
    </select>

    <!-- 근무 부서 -->
    <label>근무 부서 *</label>
    <input name="deptWhenEmployed" required />

    <!-- 직책 -->
    <label>직책 *</label>
    <input name="currentJobTitle" required />

    <!-- 현 직장/직책 -->
    <label>현 직장/직책 *</label>
    <input name="jobNow" required />

    <!-- 청탁금지법 -->
    <label>청탁금지법 적용 여부 *</label>
    <select name="antiGraft" id="antiGraft" required>
      <option value="">선택</option>
      <option value="대상">대상</option>
      <option value="비대상">비대상</option>
    </select>

    <!-- 청탁금지법 → 본인/배우자 확인 -->
    <div id="antiGraftExtra" class="hidden">
      <label>대상자 확인 *</label>
      <select name="antiGraftTarget" id="antiGraftTarget">
        <option value="">선택</option>
        <option>본인</option>
        <option>배우자</option>
      </select>
    </div>

    <!-- 배우자 직장/직책 -->
    <div id="spouseJobWrap" class="hidden">
      <label>배우자 현 직장/직책 *</label>
      <input name="spouseJob" />
    </div>

    <!-- 축의계좌 -->
    <label>축의계좌 *</label>
    <input name="bankNumber" required placeholder="000-0000-0000-00" />

    <label>은행 *</label>
    <select name="bankName" required>
      <option value="">선택</option>
      <option>국민</option><option>신한</option><option>우리</option>
      <option>하나</option><option>농협</option><option>기업</option>
      <option>기타</option>
    </select>

    <!-- 연락처 -->
    <label>연락처 *</label>
    <input name="phone" required placeholder="010-1234-5678" />

    <!-- 계좌 공개 여부 -->
    <label>퇴임임원 문자알림 계좌번호 공개 여부 *</label>
    <select name="accountDisclosure" required>
      <option value="">선택</option>
      <option>희망</option>
      <option>비희망</option>
    </select>

    <button type="submit" class="btn primary">제출</button>
  </form>

  <h3>게시판 안내문 미리보기</h3>
  <div id="previewBox" class="preview hidden"></div>
  <p id="msg"></p>
</div>

<script>
// 🚩 Apps Script URL
const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

// ===== invite.html → wedding.html 데이터 이관 =====
const inviteExtract=JSON.parse(localStorage.getItem('inviteExtract')||'{}');

// ===== 청탁금지법 대상 추가 입력 표시 =====
const antiSel=document.getElementById('antiGraft');
const extra=document.getElementById('antiGraftExtra');
const spouseJob=document.getElementById('spouseJobWrap');
antiSel.addEventListener('change',()=>{
  const v=antiSel.value;
  extra.classList.toggle('hidden',v!=='대상');
  spouseJob.classList.add('hidden');
});
document.getElementById('antiGraftTarget').addEventListener('change',e=>{
  spouseJob.classList.toggle('hidden',e.target.value!=='배우자');
});

// ===== 제출 =====
document.getElementById('form').addEventListener('submit',async e=>{
  e.preventDefault();
  const f=new FormData(e.target);
  let payload=Object.fromEntries(f.entries());

  // inviteExtract와 merge
  payload={...inviteExtract,...payload,eventType:"경사"};

  const msg=document.getElementById('msg');
  msg.textContent="전송 중..."; msg.className="";

  try{
    const res=await fetch(ENDPOINT,{method:"POST",body:JSON.stringify(payload)});
    const text=await res.text();
    const data=JSON.parse(text);

    if(data.ok){
      msg.textContent="제출 완료!"; msg.className="success";
      const box=document.getElementById('previewBox');
      box.textContent=data.preview||"미리보기를 생성할 수 없습니다.";
      box.classList.remove('hidden');
    }else{
      msg.textContent="오류: "+(data.error||"제출 실패"); msg.className="error";
    }
  }catch(err){
    msg.textContent="네트워크 오류: "+err.message; msg.className="error";
  }
});
</script>
</body>
</html>
