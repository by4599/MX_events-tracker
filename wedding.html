<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>경사 정보 제출</title>
  <style>
    :root {
      --fg: #111; --muted:#666; --border:#ddd; --ok:#0a0; --err:#c00;
    }
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:var(--fg); margin:24px; }
    .card { max-width: 640px; margin: 0 auto; padding: 20px; border: 1px solid var(--border); border-radius: 12px; }
    h2 { margin:0 0 12px; }
    label { display:block; margin:12px 0 4px; font-weight:600; }
    input, select, textarea {
      width:100%; padding:10px; border:1px solid #ccc; border-radius:8px; font:inherit;
      box-sizing:border-box;
    }
    textarea { min-height: 80px; }
    .row { display:flex; gap:8px; }
    .btn { padding:12px 16px; border:0; border-radius:8px; cursor:pointer; }
    .btn.primary { background:#111; color:#fff; }
    .hint { color:var(--muted); font-size:12px; margin-top:4px; }
    .success { color:var(--ok); margin-top:12px; }
    .error { color:var(--err); margin-top:12px; }
    .hidden { display:none; }
    .consent-line { display:flex; align-items:center; gap:8px; margin-top:8px; white-space:nowrap; }
    .consent-line input[type="checkbox"] { margin:0; }
    /* 게시판 미리보기 박스 */
    #previewBox { margin-top:20px; }
    #previewText { white-space:pre-wrap; border:1px solid #ccc; padding:12px; border-radius:8px; background:#f9f9f9; }
  </style>
</head>
<body>
  <div class="card">
    <h2>경사 정보 제출</h2>

    <!-- 개인정보 수집 고지 -->
    <script>
      alert(
        "본 설문은 MX사업부 임원 경조사 게시를 위해 정보를 수집합니다.\n" +
        "수집된 정보는 경조사 안내 목적에 사용됩니다.\n" +
        "귀하는 동의를 거부할 권리가 있으며, 동의 거부 시 안내 제공이 제한될 수 있습니다.\n\n"+
        "- 수집 항목: 성명, 재직여부, 부서, 경조사 구분, 관계, 계좌번호(본인), 연락처 등\n" +
        "- 담당부서: MX People팀 / 문의: mobile.ga@samsung.com"
      );
    </script>

    <form id="form">
      <!-- 성명 / 재직 -->
      <label>성명 *</label>
      <input name="name" required />

      <label>재직/퇴직 *</label>
      <select name="empStatus" required>
        <option value="">선택</option>
        <option>재직</option>
        <option>퇴직</option>
      </select>

      <label>근무 부서 *<span class="hint">(재직 시)</span></label>
      <input name="deptWhenEmployed" required placeholder="○○개발3그룹(무선)" />

      <label>현 직장/직책 *</label>
      <input name="currentJobTitle" required />

      <label>청탁금지법 적용 여부(배우자 포함) *</label>
      <select name="antiGraft" required>
        <option value="">선택</option>
        <option>대상</option>
        <option>비대상</option>
      </select>

      <!-- 신랑/신부측 -->
      <label>신랑/신부측 *</label>
      <div class="row">
        <label><input type="radio" name="side" value="groom" required> 신랑측</label>
        <label><input type="radio" name="side" value="bride" required> 신부측</label>
      </div>

      <!-- 가족 정보 -->
      <label>신랑 아버지 성함 *</label>
      <input name="groomFather" required />
      <label>신랑 어머니 성함 *</label>
      <input name="groomMother" required />
      <label>신랑 이름 *</label>
      <input name="groomName" required />

      <label>신부 아버지 성함 *</label>
      <input name="brideFather" required />
      <label>신부 어머니 성함 *</label>
      <input name="brideMother" required />
      <label>신부 이름 *</label>
      <input name="brideName" required />

      <!-- 형제/자매 순서 -->
      <label>형제/자매 순서 *</label>
      <select name="order" id="order" required>
        <option value="">선택</option>
        <option>장남</option><option>차남</option><option>삼남</option>
        <option>장녀</option><option>차녀</option><option>삼녀</option>
        <option value="기타">기타</option>
      </select>
      <input type="text" name="orderEtc" id="orderEtc" class="hidden" placeholder="기타 (직접 입력)" />

      <!-- 계좌 / 은행 -->
      <label>축의계좌 * <span class="hint">(본인 계좌)</span></label>
      <input name="bankNumber" required placeholder="000-0000-0000-00" />

      <label>은행 *</label>
      <select name="bankName" required>
        <option value="">선택</option>
        <option>국민</option><option>신한</option><option>우리</option>
        <option>하나</option><option>농협</option><option>기업</option>
        <option value="기타">기타</option>
      </select>

      <label>연락처 *</label>
      <input id="phone" name="phone" required placeholder="010-1234-5678" />

      <!-- 예식일시 -->
      <label>예식일시 *</label>
      <div class="row">
        <input type="date" id="eventDate" name="eventDate" required />
        <input type="time" id="eventTime" name="eventTime" step="600" required />
      </div>

      <!-- 식장 -->
      <label>식장 주소 *</label>
      <input id="venueAddr" name="venueAddr" required placeholder="도로명 주소" />

      <label>식장(상세) *</label>
      <input name="venue" required placeholder="예: ○○웨딩홀 3층 ○○홀" />

      <div class="consent-line">
        <input type="checkbox" id="consent" required />
        <label for="consent">개인정보 수집·이용에 동의합니다</label>
      </div>

      <button type="submit" class="btn primary">제출</button>
      <p id="msg"></p>
    </form>

    <!-- 📎 게시판 안내문 미리보기 -->
    <div id="previewBox" class="hidden">
      <h3>📎 게시판 안내문 미리보기</h3>
      <pre id="previewText"></pre>
    </div>
  </div>

  <script>
    // 기타 선택 시 입력칸 표시
    const orderSel = document.getElementById('order');
    const orderEtc = document.getElementById('orderEtc');
    orderSel.addEventListener('change', () => {
      orderEtc.classList.toggle('hidden', orderSel.value !== '기타');
    });

    const ENDPOINT = "<<<여기에 Apps Script 웹앱 URL /exec>>>";

    document.getElementById('form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.target;

      const date = document.getElementById('eventDate').value;
      const time = document.getElementById('eventTime').value;
      const eventDateTime = (date && time) ? `${date}T${time}` : '';

      const formData = new FormData(f);
      const payload = Object.fromEntries(formData.entries());
      payload.eventType = '경사';
      payload.eventDateTime = eventDateTime;
      payload.consent = true;

      if (payload.order === '기타') {
        payload.order = payload.orderEtc;
      }

      const msg = document.getElementById('msg');
      msg.textContent = '전송 중...'; msg.className = '';

      try {
        const res = await fetch(ENDPOINT, { 
          method: 'POST', 
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload) 
        });
        const data = await res.json();

        if (data.ok) {
          msg.textContent = '제출 완료되었습니다. 담당자가 확인 후 연락 드리겠습니다.';
          msg.className = 'success';

          if (data.preview) {
            document.getElementById('previewBox').classList.remove('hidden');
            document.getElementById('previewText').textContent = data.preview;
          }

          f.reset();
          orderEtc.classList.add('hidden');
        } else {
          msg.textContent = '오류: ' + (data.error || '제출 실패');
          msg.className = 'error';
        }
      } catch (err) {
        msg.textContent = '네트워크 오류: ' + err.message;
        msg.className = 'error';
      }
    });
  </script>
</body>
</html>
