<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>추가 정보 입력</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:24px;color:#111}
.card{max-width:720px;margin:0 auto;padding:20px;border:1px solid #ddd;border-radius:12px}
label{display:block;margin:12px 0 4px;font-weight:600}
input,select{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;box-sizing:border-box}
.btn{padding:12px 16px;border:0;border-radius:8px;cursor:pointer}
.btn.primary{background:#111;color:#fff}
.preview{white-space:pre-wrap;border:1px solid #ccc;padding:12px;border-radius:8px;background:#f9f9f9;margin-top:12px}
.hidden{display:none}
</style>
</head>
<body>
<div class="card">
  <h2>추가 정보 입력</h2>
  <form id="form">
    <label>임원 성함 *</label>
    <input name="name" required />

    <label>재직/퇴직 *</label>
    <select name="empStatus" required>
      <option value="">선택</option><option>재직</option><option>퇴직</option>
    </select>

    <label>근무부서 *</label>
    <input name="deptWhenEmployed" required />

    <label>재직 시 직책 *</label>
    <input name="pastJobTitle" required />

    <label>현 직장/직책 *</label>
    <input name="currentJobTitle" required />

    <label>청탁금지법 적용 여부 *</label>
    <select id="antiGraft" name="antiGraft" required>
      <option value="">선택</option><option value="비대상">비대상</option><option value="대상">대상</option>
    </select>

    <div id="antiGraftTarget" class="hidden">
      <label>대상자 확인 *</label>
      <select id="antiGraftWho" name="antiGraftWho">
        <option value="">선택</option><option>본인</option><option>배우자</option>
      </select>
      <div id="spouseJobWrap" class="hidden">
        <label>배우자 현 직장/직책 *</label>
        <input name="spouseJobTitle" />
      </div>
    </div>

    <label>축의 계좌번호 *</label>
    <input name="bankNumber" required placeholder="000-0000-0000-00" />

    <label>은행 *</label>
    <select name="bankName" required>
      <option value="">선택</option>
      <option>국민</option><option>신한</option><option>우리</option>
      <option>하나</option><option>농협</option><option>기업</option><option>기타</option>
    </select>

    <label>연락처 *</label>
    <input name="phone" required placeholder="010-1234-5678" />

    <label>퇴임임원 안내문자 연락처/계좌 공개 *</label>
    <select name="accountDisclosure" required>
      <option value="">선택</option><option>희망</option><option>비희망</option>
    </select>

    <button type="submit" class="btn primary">제출</button>
    <p id="msg"></p>
  </form>
</div>

<script>
const ENDPOINT="https://script.google.com/macros/s/AKfycbyY9JgPGnVIy2MlpLlxb06P9LaWamoVtx5Kn-Uo9rTXFIqrPChVyNbzI1g3ox7drytP7g/exec";

// 청탁금지법 분기
document.getElementById('antiGraft').addEventListener('change',e=>{
  document.getElementById('antiGraftTarget').classList.toggle('hidden', e.target.value!=="대상");
});
document.getElementById('antiGraftWho').addEventListener('change',e=>{
  document.getElementById('spouseJobWrap').classList.toggle('hidden', e.target.value!=="배우자");
});

// 제출
document.getElementById('form').addEventListener('submit',async e=>{
  e.preventDefault();
  const payload=Object.fromEntries(new FormData(e.target).entries());

  // inviteExtract 병합
  const invite=JSON.parse(localStorage.getItem('inviteExtract')||'{}');
  Object.assign(payload,invite);

  const msg=document.getElementById('msg');
  msg.textContent="전송 중..."; msg.className="";

  try{
    const res=await fetch(ENDPOINT,{method:'POST',body:JSON.stringify(payload)});
    const data=await res.json();
    if(data.ok){
      msg.textContent="제출 완료! 담당자가 확인 후 연락드립니다.";
      msg.className="success";
    }else{
      msg.textContent="오류: "+(data.error||"제출 실패");
      msg.className="error";
    }
  }catch(err){
    msg.textContent="네트워크 오류: "+err.message;
    msg.className="error";
  }
});
</script>
</body>
</html>
